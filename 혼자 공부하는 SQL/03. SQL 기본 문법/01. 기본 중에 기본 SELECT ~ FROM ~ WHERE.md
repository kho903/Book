# 3.1 기본 중에 기본 SELECT ~ FROM ~ WHERE
- SELECT 문은 테이블에서 데이터를 추출하는 기능을 함. 기본 형식은 SELECT ~ FROM ~ WHERE. SELECT 다음에는 열 이름, FROM 다음에는 테이블 이름, WHERE 다음에는 조건식.

## 실습용 데이터베이스 구축
### market_db.sql
#### 데이터베이스 만들기
```sql
drop table if exists market_db; -- 1
create database market_db; -- 2
use market_db; -- 3
```
1. drop table 은 market_db를 삭제하는 문장으로, 이는 market_db.sql 을 처음 실행할 때는 필요 없지만 기존 db를 초기화하기 위해 삭제한 것.
2. 데이터베이스를 새로 만듦. 
3. use 문은 market_db 데이터베이스를 선택하는 문장.

#### 회원 테이블 (member) 만들기
```sql
create table member -- 회원 테이블 (member)
(
    mem_id          char(8) not null primary key,   -- 회원 아이디 (PK)
    mem_name        varchar(10) not null,           -- 이름
    member_number   int not null,                   -- 인원수
    addr            char(2) not null,               -- 주소 (경기, 서울, 경남 식으로 2글자만 입력)
    phone1          char(3),                        -- 연락처의 국번 (02, 031, 055 등)
    phone2          char(8),                        -- 연락처의 나머지 전화번호 (하이픈 제외)
    height          smallint,                       -- 평균 키
    debut_date      date                            -- 데뷔 일자
);
```
- 여기서 varchar 는 일단 char와 동일하게 문자를 입력하는 것. 차이점은 추후에 살펴보자.

#### 구매 테이블 (buy) 만들기
```sql
create table buy -- 구매 테이블 (buy)
(
    num         int auto_increment not null primary key,    -- 순번(PK)
    mem_id      char(8) not null,                           -- 아이디(FK)
    prod_name   char(6) not null,                           -- 제품 이름
    group_name  char(4),                                    -- 분류
    price       int not null,                               -- 단가
    amount      smallint not null,                          -- 수량
    foreign key (mem_id) references member(mem_id)
);
```
- auto_increment는 자동으로 숫자를 입력해주고, 자동으로 증가함.

#### 데이터 입력하기
```sql
insert into member values('TWC', '트와이스', 9, '서울', '02', '11111111', 167, '2015.10.19'); -- 1
insert into buy values(null, 'BLK', '지갑', null, 30, 2); -- 2
```
1. 회원 테이블에 값을 입력하는 것으로, char, varchar, date 형은 작은따옴표로 값을 묶어주고, int형은 그냥 넣음.
2. 구매 테이블의 첫 번째 열인 순번(num)은 자동으로 입력되므로 그 자리에는 null이라 써 주면 됨.

#### 데이터 조회하기
```sql
select * from member;
select * from buy;
```

## 기본 조회하기 : SELECT ~ SELECT
### USE 문
- SELECT 문을 실행하기 전, 사용할 데이터베이스를 지정해야 함. 형식은 다음과 같음.
```sql
use 데이터베이스_이름;
```
- market_db 를 사용하려면 다음과 같다.
```sql
use market_db;
```

### select 문의 기본 형식
- select 문 형태. (아래 대괄호는 생략 가능)
```sql
select select_expr
    [from table_reference]
    [where where_condition]
    [group by {col_name | expr | position}]
    [having where_condition]
```
```sql
select 열_이름
    from 테이블_이름
    where 조건식
    group by 열_이름
    having 조건식
    order by 열_이름
    limit 숫자
```
- 여기서 가장 기본적이고 핵심 형태는
```sql
select 열_이름
    from 테이블_이름
    where 조건식
```

### select 와 from
```sql
select * from member;
```
- select문에 대해 하나하나 살펴보면,
1. `select` : 테이블에서 데이터를 가져올 때 사용하는 예약어. 가장 많이 사용.
2. `*` : '모든 것'을 의미. *가 사용된 위치가 열 이름이 나올 곳이므로, 모든 열을 말함.
3. `from` : 다음에 테이블 이름이 나옴. 테이블에서 내용을 가져온다는 의미.
4. `member` : 조회할 테이블 이름.
```sql
select * from member;
```
```text
+--------+--------------+------------+--------+--------+----------+--------+------------+
| mem_id | mem_name     | mem_number | addr   | phone1 | phone2   | height | debut_date |
+--------+--------------+------------+--------+--------+----------+--------+------------+
| APN    | 에이핑크     |          6 | 경기   | 031    | 77777777 |    164 | 2011-02-10 |
| BLK    | 블랙핑크     |          4 | 경남   | 055    | 22222222 |    163 | 2016-08-08 |
| GRL    | 소녀시대     |          8 | 서울   | 02     | 44444444 |    168 | 2007-08-02 |
| ITZ    | 잇지        |          5 | 경남   | NULL   | NULL     |    167 | 2019-02-12 |
| MMU    | 마마무       |          4 | 전남   | 061    | 99999999 |    165 | 2014-06-19 |
| OMY    | 오마이걸     |          7 | 서울   | NULL   | NULL     |    160 | 2015-04-21 |
| RED    | 레드벨벳     |          4 | 경북   | 054    | 55555555 |    161 | 2014-08-01 |
| SPC    | 우주소녀     |         13 | 서울   | 02     | 88888888 |    162 | 2016-02-25 |
| TWC    | 트와이스     |          9 | 서울   | 02     | 11111111 |    167 | 2015-10-19 |
| WMN    | 여자친구     |          6 | 경기   | 031    | 33333333 |    166 | 2015-01-15 |
+--------+--------------+------------+--------+--------+----------+--------+------------+
10 rows in set (0.00 sec)
```
- 원래 테이블의 전체 이름은 데이터베이스_이름.테이블_이름 형식으로 표현. 즉, market_db.member로 표현 가능. 원칙적으로는 다음과 같이 사용해야 하지만, 생략시,
use 문으로 지정해 놓은 데이터베이스가 자동으로 선택됨.
- 다음으로 필요한 열만 가져오자.
```sql
select mem_name from member;
```
```text
+--------------+
| mem_name     |
+--------------+
| 에이핑크     |
| 블랙핑크     |
| 소녀시대     |
| 잇지         |
| 마마무       |
| 오마이걸     |
| 레드벨벳     |
| 우주소녀     |
| 트와이스     |
| 여자친구     |
+--------------+
10 rows in set (0.01 sec)
```
- 여러 개 열, 그리고 별칭(alias)을 포함한 sql은 다음과 같다.
```sql
select addr 주소, debut_date "데뷔 일자", mem_name from member;
```
```text
+--------+---------------+--------------+
| 주소   | 데뷔 일자     | mem_name     |
+--------+---------------+--------------+
| 경기   | 2011-02-10    | 에이핑크     |
| 경남   | 2016-08-08    | 블랙핑크     |
| 서울   | 2007-08-02    | 소녀시대     |
| 경남   | 2019-02-12    | 잇지         |
| 전남   | 2014-06-19    | 마마무       |
| 서울   | 2015-04-21    | 오마이걸     |
| 경북   | 2014-08-01    | 레드벨벳     |
| 서울   | 2016-02-25    | 우주소녀     |
| 서울   | 2015-10-19    | 트와이스     |
| 경기   | 2015-01-15    | 여자친구     |
+--------+---------------+--------------+
10 rows in set (0.00 sec)
```

## 특정한 조건만 조회하기 : SELECT ~ FROM ~ WHERE
- where는 필요한 것들만 골라서 결과를 보는 효과를 가짐.

### WHERE 없이 조회하기
- where 없이 실제 서비스에서 조회하면 결과가 수백만건 이상으로 눈으로 찾기 힘들 뿐더러, 고성능 컴퓨터라도 부담일 것. 그래서 select문은 기본적으로 where과 함께 사용.

### 기본적인 where 절.
```sql
select 열_이름 from 테이블_이름 where 조건식;
```
- 또는
```sql
select 열_이름
    from 테이블_이름
    where 조건식;
```
```sql
select * from member where mem_name = '블랙핑크';
```
```text
+--------+--------------+------------+--------+--------+----------+--------+------------+
| mem_id | mem_name     | mem_number | addr   | phone1 | phone2   | height | debut_date |
+--------+--------------+------------+--------+--------+----------+--------+------------+
| BLK    | 블랙핑크     |          4 | 경남   | 055    | 22222222 |    163 | 2016-08-08 |
+--------+--------------+------------+--------+--------+----------+--------+------------+
1 row in set (0.01 sec)
```
```sql
select * from member where mem_number = 4;
```
```text
+--------+--------------+------------+--------+--------+----------+--------+------------+
| mem_id | mem_name     | mem_number | addr   | phone1 | phone2   | height | debut_date |
+--------+--------------+------------+--------+--------+----------+--------+------------+
| BLK    | 블랙핑크     |          4 | 경남   | 055    | 22222222 |    163 | 2016-08-08 |
| MMU    | 마마무       |          4 | 전남   | 061    | 99999999 |    165 | 2014-06-19 |
| RED    | 레드벨벳     |          4 | 경북   | 054    | 55555555 |    161 | 2014-08-01 |
+--------+--------------+------------+--------+--------+----------+--------+------------+
3 rows in set (0.00 sec)
```

#### 관계 연산자, 논리 연산자의 사용
- 숫자로 표현된 데이터는 범위 지정 가능. 관계 연산자 (<=, 작거나 같다 등)을 사용해서 조회 가능.
```sql
select mem_id, mem_name from member where height <= 162;
```
```text
+--------+--------------+
| mem_id | mem_name     |
+--------+--------------+
| OMY    | 오마이걸     |
| RED    | 레드벨벳     |
| SPC    | 우주소녀     |
+--------+--------------+
3 rows in set (0.00 sec)
```
- 2가지 이상의 조건을 만족하도록 논리 연산 AND 로 조회 가능.
```sql
select mem_name, height, mem_number from member where height >= 165 and mem_number > 6;
```
```text
+--------------+--------+------------+
| mem_name     | height | mem_number |
+--------------+--------+------------+
| 소녀시대     |    168 |          8 |
| 트와이스     |    167 |          9 |
+--------------+--------+------------+
2 rows in set (0.00 sec)
```
- ~이거나 ~인 조건을 달기 위해 연산자 OR로 조회 가능. AND는 두 조건이 모두 만족해야 하는 것이라면, OR는 두 조건 중 하나만 만족해도 됨.
```sql
select mem_name, height, mem_number from member where height >= 165 or mem_number > 6;
```
```text
+--------------+--------+------------+
| mem_name     | height | mem_number |
+--------------+--------+------------+
| 소녀시대     |    168 |          8 |
| 잇지         |    167 |          5 |
| 마마무       |    165 |          4 |
| 오마이걸     |    160 |          7 |
| 우주소녀     |    162 |         13 |
| 트와이스     |    167 |          9 |
| 여자친구     |    166 |          6 |
+--------------+--------+------------+
7 rows in set (0.00 sec)
```

#### BETWEEN ~ AND
- AND 를 사용해 평균 키 163~165 를 조회해 보자.
```sql
select mem_name, height from member where height >= 163 and height <= 165;
```
```text
+--------------+--------+
| mem_name     | height |
+--------------+--------+
| 에이핑크     |    164 |
| 블랙핑크     |    163 |
| 마마무       |    165 |
+--------------+--------+
3 rows in set (0.00 sec)
```
- 그런데 범위에 있는 값을 구할 때에는 BETWEEN ~ AND도 사용 가능.
```sql
select mem_name, height from member where height between 163 and 165;
```
```text
+--------------+--------+
| mem_name     | height |
+--------------+--------+
| 에이핑크     |    164 |
| 블랙핑크     |    163 |
| 마마무       |    165 |
+--------------+--------+
3 rows in set (0.00 sec)
```

#### IN()
- 숫자와 달리 문자ㅏ 데이터는 어느 범위에 들어 있다고 표현할 수 없어, or을 쓸경우 일일이 써줘야 함.
```sql
select mem_name, addr from member where addr = '경기' or addr = '전남' or addr = '경남';
```
```text
+--------------+--------+
| mem_name     | addr   |
+--------------+--------+
| 에이핑크     | 경기   |
| 블랙핑크     | 경남   |
| 잇지         | 경남   |
| 마마무       | 전남   |
| 여자친구     | 경기   |
+--------------+--------+
5 rows in set (0.00 sec)
```
- in() 을 사용해 코드를 훨씬 간결하게 할 수 있음.
```sql
select mem_name, addr from member where addr in('경기', '전남', '경남');
```
```text
+--------------+--------+
| mem_name     | addr   |
+--------------+--------+
| 에이핑크     | 경기   |
| 블랙핑크     | 경남   |
| 잇지         | 경남   |
| 마마무       | 전남   |
| 여자친구     | 경기   |
+--------------+--------+
5 rows in set (0.00 sec)
```

#### LIKE
- 문자열의 일부 글자를 검색하려면 LIKE를 사용함. '우%'란, 첫 글자가 '우'이고 그 뒤는 무엇이든(%) 허용한다는 의미.
```sql
select * from member where mem_name like '우%';
```
```text
+--------+--------------+------------+--------+--------+----------+--------+------------+
| mem_id | mem_name     | mem_number | addr   | phone1 | phone2   | height | debut_date |
+--------+--------------+------------+--------+--------+----------+--------+------------+
| SPC    | 우주소녀     |         13 | 서울   | 02     | 88888888 |    162 | 2016-02-25 |
+--------+--------------+------------+--------+--------+----------+--------+------------+
1 row in set (0.00 sec)
```
- 한 글자와 매치하기 위해서는 언더바를 사용.
```sql
select * from member where mem_name like '__핑크';
```
```text
+--------+--------------+------------+--------+--------+----------+--------+------------+
| mem_id | mem_name     | mem_number | addr   | phone1 | phone2   | height | debut_date |
+--------+--------------+------------+--------+--------+----------+--------+------------+
| APN    | 에이핑크     |          6 | 경기   | 031    | 77777777 |    164 | 2011-02-10 |
| BLK    | 블랙핑크     |          4 | 경남   | 055    | 22222222 |    163 | 2016-08-08 |
+--------+--------------+------------+--------+--------+----------+--------+------------+
```

## 서브 쿼리
- SELECT 안에는 또 다른 SELECT가 들어갈 수 있음. 이것을 서브 쿼리 (subquery)라 부름.
- 예로, 이름이 '에이핑크'인 회원의 평균 키보다 큰 회원을 검색하고 싶다고 가정.
```sql
select height from member where mem_name = '에이핑크';
```
```text
+--------+
| height |
+--------+
|    164 |
+--------+
1 row in set (0.02 sec)
```
- 이제는 164보다 평균 키가 큰 회원을 조회하면 됨.
```sql
select mem_name, height from member where height > 164;
```
```text
+--------------+--------+
| mem_name     | height |
+--------------+--------+
| 소녀시대     |    168 |
| 잇지         |    167 |
| 마마무       |    165 |
| 트와이스     |    167 |
| 여자친구     |    166 |
+--------------+--------+
5 rows in set (0.01 sec)
```
- 위 sql 두 개를 서브쿼리를 사용해 하나로 만들 수 있음.
```sql
select mem_name, height from member where height > (select height from member where mem_name = '에이핑크');
```
```text
+--------------+--------+
| mem_name     | height |
+--------------+--------+
| 소녀시대     |    168 |
| 잇지         |    167 |
| 마마무       |    165 |
| 트와이스     |    167 |
| 여자친구     |    166 |
+--------------+--------+
5 rows in set (0.01 sec)
```
- 세미콜론이 하나이므로 이 SQL은 하나의 문장.
- 서브쿼리의 장점은 2개의 SQL을 하나로 만듦으로써 하나의 SQL만 관리하면 되므로 간단해진다는 것.

## 정리
- USE 문은 데이터베이스를 선택하는 구문으로 한 번 지정하면 계속 유지됨.
- SELECT ~ FROM ~ WHERE 문은 가장 기본적인 SQL. SELECT 다음에는 열 이름이, FROM 다음에는 테이블 이름이, WHERE 다음에는 다양한 조건식이 올 수 있음.
- 관계 연산자는 WHERE 절에서 크다 / 작다 / 같다 등을 지정하는 기호로, <, <=, >, >=, = 등이 있음.
- 논리 연산자는 관계 연산자가 2개 이상 나오면 AND, OR 등으로 참/거짓을 판별함.
- LIKE는 문자열 비교시 모두 허용할 때는 %, 하나로 지정할 때는 _를 사용

## 용어 정리
- 주석 (remark) : 하이픈 (-) 2개와 설명으로 구성
- VARCHAR : 문자형으로 CHAR와 거의 비슷함
- AUTO_INCREMENT : 자동으로 숫자를 입력시켜줌. 테이블을 생성할 때 지정함
- `*` : 모든 열을 지정할 때 사용하는 기호
- 별칭 (alias) : SELECT 문에서 실제 열 이름 대신에 출력되도록 설정하는 문자
- % : 문자열에서 여러 문자에 대응하는 기호
- _ : 문자열에서 한 문자에 대응하는 기호

