# 20. 행 개수 구하기 - COUNT
- 대표적인 집계함수는 5개가 있다.
  - COUNT(집합), SUM(집합), AVG(집합), MIN(집합), MAX(집합)
- SQL은 데이터베이스라 불리는 '데이터 집합'을 다루는 언어. 이 같은 집합의 개수나 합계가 궁금하면 집계함수를 사용해 간단히 구할 수 있다.
  - COUNT 집계함수로 테이블 행 개수를 구할 수 있다.

## 1. COUNT로 행 개수 구하기
- SQL은 집합을 다루는 집계함수 제공. 일반적인 함수는 인수로 하나의 값을 지정하는 데 비해 집계함수는 인수로 집합 지정. 이 때문에 집합함수라고도 불림.
즉, 집합을 특정 방법으로 계산해 그 결과 반환.
- COUNT 함수는 인수로 주어진 집합의 '개수'를 구해 반환.
- COUNT
```text
COUNT(집합)
```
```text
mysql> select * from sample51;
+------+------+----------+
| no   | name | quantity |
+------+------+----------+
|    1 | A    |        1 |
|    2 | A    |        2 |
|    3 | B    |       10 |
|    4 | C    |        3 |
|    5 | NULL |     NULL |
+------+------+----------+
5 rows in set (0.00 sec)

mysql> select count(*) from sample51;
+----------+
| count(*) |
+----------+
|        5 |
+----------+
1 row in set (0.01 sec)
```
- sample51 에는 전부 다섯 개의 행이 있으며 COUNT의 결괏값도 5이다. 인수로 *가 지정되어 있는데 이는 SELECT 구에서 '모든 열'을 나타낼 때 사용하는
메타문자와 같다. 다만 이떄 COUNT 집계함수에서는 '모든 열 = 테이블 전체'라는 의미로 사용된다. 즉, COUNT는 인수로 지정된 집합(이 경우는 테이블 전체)의
개수를 계산하는 것. sample51에는 5개의 행이 있으므로 5가 반환되었다.
> COUNT 집계함수로 행 개수를 구할 수 있다!
- 집계함수의 특징은 복수의 값(집합)에서 하나의 값을 계산해내는 것. 일반적인 함수는 하나의 행에 대해 하나의 값 반환. 한편 집계함수는 집합으로부터 하나의 값
반환. 이렇게 집합으로부터 하나의 값을 계산하는 것을 '집계'라 부른다. 이러한 이유로 집계함수를 SELECT 구에 쓰면 WHERE 구의 유무와 관계없이 결괏값으로
하나의 행을 반환한다.

### WHERE 구 지정하기
- 정말 하나의 행만 반환되는지 알아보자. sample51 테이블에는 총 다섯 개의 행이 있다. 그 중에 name 열이 A인 행을 검색해 COUNT로 행의 개수를 구해보자.
- 현재 name열이 A인 행의 개수는 2개로, 각각의 no 값이 1, 2이다. COUNT 결과는 어떻게 될까?
```text
mysql> select * from sample51 where name = 'A';
+------+------+----------+
| no   | name | quantity |
+------+------+----------+
|    1 | A    |        1 |
|    2 | A    |        2 |
+------+------+----------+
2 rows in set (0.00 sec)

mysql> select count(*) from sample51 where name = 'A';
+----------+
| count(*) |
+----------+
|        2 |
+----------+
1 row in set (0.00 sec)
```
- SELECT 구는 WHERE 구보다 나중에 내부적으로 처리된다. 따라서 WHERE 구로 조건을 지정하면 테이블 전체가 아닌, 검색된 행이 COUNT로 넘겨진다.
즉, WHERE 구의 조건에 맞는 행의 개수를 구할 수 있다.

## 2. 집계함수와 NULL 값
- COUNT의 인수로 열명 지정 가능. 열명 지정시 그 열에 한해서 행의 개수를 구할 수 있다. 실제로 집계함수는 보통 그 같은 목적을 위해 많이 사용됨.
특히 *를 인수로 사용할 수 있는 것은 COUNT 함수 뿐. 다른 집계함수에서는 열명이나 식을 인수로 지정한다.
- 여기서 문제는 NULL 값을 어떻게 취급하느냐는 것. SQL에서는 NULL 값을 고려해야 한다. 집계함수는 집합 안에 NULL 값이 있을 경우 이를 제외하고 처리함.
```text
mysql> select * from sample51;
+------+------+----------+
| no   | name | quantity |
+------+------+----------+
|    1 | A    |        1 |
|    2 | A    |        2 |
|    3 | B    |       10 |
|    4 | C    |        3 |
|    5 | NULL |     NULL |
+------+------+----------+
5 rows in set (0.00 sec)

mysql> select count(no), count(name) from sample51;
+-----------+-------------+
| count(no) | count(name) |
+-----------+-------------+
|         5 |           4 |
+-----------+-------------+
1 row in set (0.00 sec)
```
- no 열의 행 개수는 5, name 열의 행 개수는 4로 나타났다. name 열에는 NULL 값을 가지는 행이 하나 존재하므로 이를 제외한 개수가 출력됨. 다만,
COUNT(*)의 경우 모든 열의 행수를 카운트하기 때문에 NULL 값이 있어도 해당 정보가 무시되지 않는다.
```text
mysql> select count(no), count(name), count(*) from sample51;
+-----------+-------------+----------+
| count(no) | count(name) | count(*) |
+-----------+-------------+----------+
|         5 |           4 |        5 |
+-----------+-------------+----------+
1 row in set (0.00 sec)
```
> 집계함수는 집합 안에 NULL 값이 있을 경우 무시한다!

## 3. DISTINCT로 중복 제거
- 집합을 다룰 때, 경우에 따라서 집합 안에 중복된 값이 있는지 여부가 문제될 때도 있다. 데이터가 서로 중복되지 않는 경우 '유일한 값을 가진다'라든가
'값이 중복되지 않는다'라는 표현을 자주 한다.
```text
mysql> select * from sample51;
+------+------+----------+
| no   | name | quantity |
+------+------+----------+
|    1 | A    |        1 |
|    2 | A    |        2 |
|    3 | B    |       10 |
|    4 | C    |        3 |
|    5 | NULL |     NULL |
+------+------+----------+
5 rows in set (0.00 sec)
```
- sample51의 no 열은 1, 2, 3 ... 과 같이 일련의 숫자로 되어 있어 중복은 안 된다. 한편 name 열의 값은 맨 위의 두 줄이 A로 값이 중복된다.
name 열의 값은 총 A, B, C 및 NULL의 네 가지이다.
- SQL의 SELECT 명령은 이러한 중복된 값을 제거하는 함수 제공. 이떄 사용하는 키워드가 바로 DISTINCT.
```text
mysql> select all name from sample51;
+------+
| name |
+------+
| A    |
| A    |
| B    |
| C    |
| NULL |
+------+
5 rows in set (0.00 sec)

mysql> select distinct name from sample51;
+------+
| name |
+------+
| A    |
| B    |
| C    |
| NULL |
+------+
4 rows in set (0.01 sec)
```
- DISTINCT 는 예약어로 열명이 아니다. SELECT 구에서 DISTINCT 를 지정하면 중복된 데이터를 제외한 결과를 클라이언트로 반환. 중복 여부는 SELECT
구에 지정된 모든 열을 비교해 판단한다.
- 앞에 있는 ALL을 지정하면 중복 유무와 관계없이 문자 그대로 모든 행을 반환. 즉, SELECT 구에 지정하는 ALL 또는 DISTINCT는 중복된 값을 제거할 
것인지 설정하는 스위치와 같은 역할을 한다. 이때 ALL 과 DISTINCT 중 어느것도 지정하지 않은 경우에는 중복된 값은 제거되지 않는다. 즉, 생략시 ALL.
> DISTINCT 로 중복값을 제거할 수 있다!

## 4. 집계함수에서 DISTINCT
- COUNT 집계함수를 이용해 집합의 개수를 구하는 방법을 보았다. 그리고 DISTINCT를 지정하면 중복된 값을 제거할 수 있는 것을 보았다.
- 그렇다면 name 열에서 NULL 값을 제외하고, 중복하지 않는 데이터의 개수(A, B, C 3개)을 구하는 경우를 생각해보자. COUNT, DISTINCT, WHERE 구의
조건을 지정해 구할 수 있을까? 정답은 할 수 없다 이다.
- WHERE 구에서는 검색할 조건을 지정하는 것밖에 할 수 없다. 중복된 값인지 아닌지를 알아보는 함수도 없다. SELECT DISTINCT COUNT(name)이라는
SELECT 명령으로도 안 된다. COUNT 쪽이 먼저 계산되어 버리기 때문.
- 방법은 집계함수의 인수로 DISTINCT을 사용한 수식을 지정하는 것. DISTINCT는 집계함수의 인수에 수식자로 지정 가능. DISTINCT를 이용해 집합에서
중복을 제거한 뒤 COUNT로 개수를 구할 수 있다. 
```text
mysql> select count(all name), count(distinct name) from sample51;
+-----------------+----------------------+
| count(all name) | count(distinct name) |
+-----------------+----------------------+
|               4 |                    3 | <- null을 제외한 값의 개수
+-----------------+----------------------+
1 row in set (0.00 sec)
```
- SELECT 구에서의 중복삭제와 마찬가지로, DISTINCT 가 아닌 ALL을 지정하면 집합 전부가 집계함수에 주어진다. 앞서 설명했듯이 ALL을 생략해도 결과는 
같다.
