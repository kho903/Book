# 2-3 데이터베이스 개체
- 테이블은 데이터베이스의 핵심 개체. 테이블 외에도 인덱스, 뷰, 스토어드 프로시저, 트리거, 함수, 커서 등의 개체도 필요.
- 인덱스는 테이블 조회시 결과가 나오는 속도를 빠르게 해주고, 뷰는 테이블의 일부를 제한적으로 표현할 때 사용. 스토어드 프로시저는 SQL에서 프로그래밍이 가능하도록 해주고, 트리거는 잘못된 데이터가 들어가는 것을 미연에 방지.

## 인덱스
### 인덱스 개념 이해하기
- 인덱스(index)란 책의 제일 뒤에 수록되는 '찾아보기'와 비슷한 개념. 

### 인덱스 실습
```sql
select * from member where member_name = '아이유'
```
- 위 sql문의 결과는 당연히 아이유를 잘 찾았을 것. workbench 내의 Execution Plan(실행 계획)을 보면 Full Table Scan이라고 나올 것. 해석하면 전체 테이블 검색.
- 처음부터 끝까지 오랜 시간이 걸려서 찾은 것. 현재 인덱스가 없기 때문.
- 인덱스를 만들어 보자.
```sql
create index idx_member_name on member(member_name);
```
- 인덱스는 열에 지정하고, SQL의 마지막에 ON member(member_name)의 의미는 member 테이블의 member_name 열에 인덱스를 지정하라는 의미.
- 똑같이 select 문을 사용해 보자. 동일한 결과를 반환하지만 찾는 방법이 달라졌을 것. Execution Plan 탭을 보면 Non-Unique Key Lookup 이라고 나옴.
- Key Lookup은 인덱스를 통해 결과를 찾았다고 기억하면 됨. 이런 방법을 인덱스 검색 (Index Scan)이라고 부름.
- 인덱스에서 기억해야 할 점은 인덱스 생성 여부에 따라 결과가 달라지지는 않는다는 것.

## 뷰
- 뷰는 테이블과 상당히 동일한 성격의 데이터베이스 개체. 보완도 강화하고 SQL문도 간단히 사용 가능.

### 뷰 개념 이해하기
- 뷰(view)를 한마디로 정의하면 '가상의 테이블'. 일반 사용자는 테이블과 뷰 구분 불가. 다만 뷰는 실제 데이터를 가지고 있지 않으며, 진짜 테이블에 링크(link)된 개념이라고 생각하면 됨.
- 뷰는 윈도우즈의 '바로가기 아이콘'과 비슷한 개념. 실체는 없으며 테이블과 연결되어 있는 것 뿐. 사용자가 뷰를 테이블처럼 생각해서 접근하면 알아서 테이블과 연결해줌. 뷰의 실체는 SELECT 문.

### 뷰 실습
```sql
create view member_view
as
    select * from member;
```
- 회원 테이블과 연결되는 회원 뷰 (member_view)를 만들기 위한 SQL.
```sql
select * from member_view;
```
```text
+-----------+-------------+----------------------------+
| member_id | member_name | member_addr                |
+-----------+-------------+----------------------------+
| hero      | 임영웅      | 서울 은평구 증산동         |
| iyou      | 아이유      | 인천 남구 주안동           |
| jyp       | 박진영      | 경기 고양시 장항동         |
| tess      | 나훈아      | 경기 부천시 중동           |
+-----------+-------------+----------------------------+
4 rows in set (0.00 sec)
```
- 뷰에 접근하는 것은 테이블에 접근하는 것과 동일.
- 테이블을 사용하지 않고 뷰를 사용하는 이유
1. 보안
2. 긴 SQL을 간략하게 만들 수 있음.

## 스토어드 프로시저
- 스토어드 프로시저(stored procedure)로 SQL 안에서도 일반 프로그램 언어처럼 코딩 가능.

### 개념
- 스토어드 프로시저란 MySQLdㅔ서 제공하는 프로그래밍 기능으로 여러 개의 SQL 문을 하나로 묶어서 편리하게 사용 가능. + 연산식, 조건문, 반복문 사용 가능.

### 실습
```SQL
select * from member where member_name = '나훈아';
select * from product where product_name = '삼각김밥';
```
- 위 두 SQL이 상당히 자주 사용된다고 가정. 매번 두 줄의 SQL을 입력해야 한다면 불편할 것이다.
- 두 SQL을 하나의 스토어드 프로시저로 만들어 보자.
```sql
delimiter //
create procedure myProc()
begin
	select * from member where member_name = '나훈아';
    select * from product where product_name = '삼각김밥';
end //
delimiter ;
```
- 첫 행과 마지막 행에 구분 문자라는 의미의 DELIMETER // ~ DELIMETER ; 문은 스토어드 프로시저를 묶어주는 약속.
- 그리고 BEGIN, END 사이에 SQL 문을 넣으면 됨.
- 스토어드 프로시저를 호출하기 위해서는 아래와 같이 CALL 문을 실행하면 됨.
```sql
call myProc();
```

## 정리
- 인덱스는 책 뒤의 '찾아보기'와 같은 개념으로 데이터를 빠르게 찾을 수 있도록 도와줌.
- 뷰는 '바로 가기 아이콘'과 비슷한 개념으로 한마디로 '가상의 테이블'.
- 스토어드 프로시저는 여러 개의 SQL을 묶어주거나, 프로그래밍 기능을 제공해줌.

## 용어 정리
- 데이터베이스 개체 (Database Object) : 테이블, 뷰, 인덱스, 스토어드 프로시저 등 데이터베이스 안에 저장되는 개체
- 실행 계획 (Execution Plan) : SQL을 실행할 때, 인덱스 사용 여부를 확인할 수 있는 워크벤치의 화면
- 전체 테이블 검색 (Full Table Scan) : 테이블의 모든 데이터를 훑어서 원하는 데이터를 찾아내는 것을 말함. 책 전체를 찾아보는 것과 비슷함
- 인덱스 검색 (Index Scan) : 인덱스를 통해서 데이터를 찾는 것을 말함.
- 구분 문자 (DELIMITER) : 스토어드 프로시저를 묶어주는 예약어
- 호출 (CALL) : 스토어드 프로시저를 호출하는 예약어
- 개체 생성문 (CREATE) : 데이터베이스 개체를 생성할 때 사용하는 예약어
- 개체 삭제문 (DROP) : 데이터베이스 개체를 삭제할 때 사용하는 예약어

