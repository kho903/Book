# 08. 패턴 매칭에 의한 검색
- 'LIKE' 술어를 사용하면 문자열의 일부분을 비교하는 '부분 검색'을 할 수 있다.
```text
열 LIKE 패턴
```
- = 연산자로 검색하는 경우는 셀의 데이터 값이 완전히 동일한지를 비교한다. 하지만 '특정 문자나 문자열이 포함되어 있는지를 검색하고 싶은' 경우도 많을 것이다.
- 이런 경우 사용하는 방법으로 '패턴 매칭' 또는 '부분 검색'이라고도 한다.

## 1. LIKE로 패턴 매칭하기
- = 연산자로 검색할 경우에는 열 값이 완전히 일치할 떄 참이 된다. LIKE 술어를 사용하면 열 값이 부분적으로 일치하는 경우에도 참이 된다.
```text
열명 LIKE 패턴
```
- KIKE 술어는 이항 연산자처럼 항목을 지정한다. 왼쪽에는 매칭 대상을 지정하고 오른 쪽에는 패턴을 문자열로 지정한다.
- 단, 수치형 상수는 지정할 수 없다. 패턴을 정의할 때는 다음과 같은 메타문자를 사요앟ㄹ 수 있다.
```text
%_
```
- '와일드카드'라고도 불리는 메타문자는 패턴 매칭 시 '임의의 문자 또는 문자열'에 매치하는 부분을 지정하기 위해 쓰이는 특수 문자이다. 퍼센트(%)는 임의의 문자열을
의미하며, 언더스코어(_)는 임의의 문자 하나를 의미한다. 패턴을 정의할 떄는 메타문자를 여러 개 사용할 수 있다.
- 한편 메타문자를 전혀 정의하지 않아도 문제 없지만, 완전 일치로 검색되므로 정의하는 의미가 없다. 와일드카드로 주로 쓰이는 *는 LIKE에서는 사용할 수 없다.
> LIKE 술어를 사용하여 패턴 매칭으로 검색할 수 있다!<br>
> 패턴을 정의할 때 사용할 수 있는 메타문자로는 % 와 _이 있다.
```text
mysql> mysql> select * from  sample25;
+------+-----------------------------------------------------------------+
| no   | text                                                            |
+------+-----------------------------------------------------------------+
|    1 | SQL은 RDBMS를 조작하기 위한 언어이다.                           |
|    2 | LIKE에서는 메타문자 %와 _를 사용할 수 있다.                     |
|    3 | LIKE는 SQL에서 사용할 수 있는 술어 중 하나이다.                 |
+------+-----------------------------------------------------------------+
3 rows in set (0.00 sec)
```
- sample25 테이블의 text 열에는 문자열이 저장되어 있다. 전부 3개의 행이 존재. 여기에서 문자열 'SQL'을 포함하는 행을 패턴 매칭으로 검색해보자.
- 우선 SQL% 로 검색을 해보자.
```text
mysql> select * from sample25 where text like 'SQL%';
+------+---------------------------------------------------+
| no   | text                                              |
+------+---------------------------------------------------+
|    1 | SQL은 RDBMS를 조작하기 위한 언어이다.             |
+------+---------------------------------------------------+
1 row in set (0.00 sec)
```
- 문제 없이 문자열 'SQL'을 포함하는 행이 검색되었지만 no가 3인 행에도 'SQL'이 포함되어 있는 것을 볼 수 있다. 
- 이 행이 검색되지 않은 것은 text 열 값이 SQL로 시작되지 않기 때문이다. 다시 말해 'SQL' 앞에도 문자열이 존재하기 때문이다.
- 이처럼 문자열 도중에 존재하는 'SQL'을 검색하고자 한다면 다음과 같이 패턴을 바꿀 필요가 있다.
```text
mysql> select * from sample25 where text like '%SQL%';
+------+-----------------------------------------------------------------+
| no   | text                                                            |
+------+-----------------------------------------------------------------+
|    1 | SQL은 RDBMS를 조작하기 위한 언어이다.                           |
|    3 | LIKE는 SQL에서 사용할 수 있는 술어 중 하나이다.                 |
+------+-----------------------------------------------------------------+
2 rows in set (0.01 sec)
```
- 핵심은 메타문자 %가 빈 문자열과도 매치하는 것. 첫 번쨰 행의 경우 '%SQL%'에서 'SQL' 앞의 %에 매치하는 문자열은 없는데도 검색이 되었다!
> %는 임의의 문자열과 매치하며, 빈 문자열에도 매치한다!
- 'SQL%'을 이용한 검색은 문자열 앞쪽에 지정한 문자와 일치하므로 '전방 일치'라고 부르며, 지정한 문자 뒤로 임의의 문자열이 존재하게 된다. 
- 한편 '%SQL%'의 경우는 지정 문자열이 중간에 있기 때문에 '중간 일치'라고 부르며 지정한 문자 앞뒤로 임의의 문자열이 존재한다.
- '%SQL'과 같이 검색하면 '후방 일치'가 된다. 즉, 앞쪽에 임의의 문자열이 존재한다.

## 2. LIKE로 %를 검색하기
- sample25의 두 번째 행은 데이터 안에 %와 _를 포함한다. 이는 메타문자와 동일한 문자로 이를 LIKE로 검색할 경우 어떻게 정의할까
- LIKE에서는 메타문자 부분이 임의의 문자열을 의미하므로, % 자신을 검색조건으로 지정할 때는 WHERE text LIKE '%%%'로도 매치하지 않기 떄문에 구분할
필요가 있다. 프로그래밍 세계에서는 이러한 문제를 '이스케이프'라는 방법으로 처리 가능.
- LIKE로 %를 검색하는 경우에는 '\%'와 같이 \를 %앞에 붙인다. 결국 %를 포함하는 데이터를 검색하고 싶을 경우 조건식은 다음과 같다.
```text
WHERE text LIKE '%\%%'
```
```text

mysql> select * from sample25;
+------+-----------------------------------------------------------------+
| no   | text                                                            |
+------+-----------------------------------------------------------------+
|    1 | SQL은 RDBMS를 조작하기 위한 언어이다.                           |
|    2 | LIKE에서는 메타문자 %와 _를 사용할 수 있다.                     |
|    3 | LIKE는 SQL에서 사용할 수 있는 술어 중 하나이다.                 |
+------+-----------------------------------------------------------------+
3 rows in set (0.00 sec)

mysql> select * from sample25 where text like '%\%%';
+------+------------------------------------------------------------+
| no   | text                                                       |
+------+------------------------------------------------------------+
|    2 | LIKE에서는 메타문자 %와 _를 사용할 수 있다.                |
+------+------------------------------------------------------------+
1 row in set (0.00 sec)
```
- 맨 앞의 %는 메타문자의 %, 임의의 문자열과 매치한다. 그 다음에 나오는 %는 앞에 \가 있어 이스케이프 된 것을 의미하기 떄문에 메타문자가 아닌 일반문자 %를 의미
> %를 LIKE로 검색할 경우에는 \%로 한다! <br>
> _를 LIKE로 검색할 경우에는 \_로 한다!

## 3. 문자열 상수 ' 의 이스케이프
- 메타문자를 검색할 떄처럼 문자열 상수를 검색할 때도 같은 문제가 발생한다. 문자열 상수는 '문자열'과 같이 '로 둘러싸 표기하는데, 문자열 상수 안에 '를 포함하고
싶을 때는 '를 2개 연속해서 기술하는 것으로 이스케이프 처리를 할 수 있다.(표준 SQL)
- 예를 들면 'It's' 라는 문자열을 문자열 상수로 표기하면 'It''s'로 쓴다. 또한 '하나만 문자열 데이터일 경우에는 ''''으로 쓰면 된다.
- SQL 뿐만 아니라 프로그래밍 언어에서는 시작과 끝이 구분되지 않으면 에러가 발생한다. SQL에서는 싱글쿼트로 문자열 상수를 기술하는데 시작의 '과 끝의 '이 
정확하게 표기되지 않으면 에러가 발생하므로 주의해야 한다.
> '을 문자열 상수 안에 포함할 경우는 '를 2개 연속해서 기술한다!

## 정리
- 간단한 패턴 매칭이라면 LIKE로 충분하지만 더 복잡한 패턴을 매칭하는 경우는 정규 표현식(Regular Expression)을 사용하는 편이 더 낫다.
- 최근에는 대부분의 데이터베이스가 정규 표현식을 지원. 정규 표현식에서는 더 많은 메타문자를 사용해서 폭넓게 패턴 지정 가능.
