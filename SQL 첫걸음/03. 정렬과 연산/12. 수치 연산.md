# 12. 수치 연산
- SQL 은 데이터베이스를 조작하는 언어이지만 컴퓨터를 조작하는 언이기도 한 만큼 기본적으로 계산기능을 포함한다. 여기서는 수치 연산 방법에 대해 알아보자.
- 산술 연산
```text
+ - * / % MOD
```
- 어떤 계산을 할니는 연산자를 이용해 지정한다. WHERE 구에서 조건을 지정할 떄 사용했던 = 역시 연산자의 하나.
- 여기에서는 수치를 연산하는 산술 연산에 관해 알아보자. 산술 연산은 다른 프로그래밍 언어에서도 사용하는 기본 개념이다.

## 1. 사칙 연산
- 산술 연산은 덧셈, 뺄셈, 곱셈, 나눗셈의 사칙 연산과 나눗셈의 나머지, 크게 이 두 가지를 기본적으로 익혀두면 된다.
- 연산자는 기호로 표기. 각 연산자에 대해 다음 표를 보자.

| 연산자 | 연산      | 예          |
|-----|---------|------------|
| +   | 덧셈(가산)  | 1+2 -> 3   |
| -   | 뺄셈(감산)  | 1-2 -> -1  |
| *   | 곱셈(승산)  | 1*2 -> 2   |
| /   | 나눗셈(제산) | 1/2 -> 0.5 |
| %   | 나머지     | 1%2 -> 1   |

- 곱셈은 x 대신 *(애스터리스크)를 사용. * 는 '모든 열'을 의미하는 메타 문자이지만 연산자로도 사용 가능.
- 나눗셈의 기호는 ÷ 이지만 컴퓨터 언어에서는 슬래시(/)를 사용. 나머지는 나눗셈을 한 후의 나머지를 계산하는 것으로 % 기호를 사용..
- 1 % 2 의 경우 1 / 2 의 나머지가 된다. 몫이 0 나머지가 1이므로 1이 된다.
- 데이터베이스 제품마다 적용하는 함수가 다른데, % 대신 MOD 함수를 사용하는 경우도 있다.
> 연산자를 사용해 여러 가지 연산을 할 수 있다.

### 연산자의 우선순위
| 우선순위 | 연산자   |
|------|-------|
| 1    | * / % |
| 2    | + -   |
- 곱셈, 나눗셈, 나머지 그룹과 덧셈, 뺄셈 그룹으로 나뉜다. 같은 그룹 내 연산자의 우선 순위는 동일.
- 계산 순서는 연산자에 따라 관계없는 경우도 있지만 기본적으로 왼쪽에서 오른쪽으로 진행된다. 우선순위가 같은 연산자들끼리 연산하는 경우는 문제가 되지 않지만,
우선순위가 다른 연산자들이 섞여 있는 경우는 우선순위가 높은 쪽이 먼저 계산된다.
- SQL 명령에서는 여러 부분에서 산술 연산자를 사용해 연산 가능. 앞에서 보았던 SELECT 구나 WHERE 구 안에서도 연산 가능.

## 2. SELECT 구로 연산하기
- 앞에서 'SELECT 구에는 열명을 지정한다'고 보았다. 이 외에도 여러 가지 식을 기술할 수 있다. 이 식은 열명, 연산자, 상수로 구성된다.
- SELECT 구
```text
SELECT 식 1, 실 2 ... FROM 테이블명
```
- 식을 기술할 수 있다는 것은 명령이 실행될 때 연산을 할 수 있다는 것을 의미. 
```text
mysql> select * from sample34;
+------+-------+----------+
| no   | price | quantity |
+------+-------+----------+
|    1 |   100 |       10 |
|    2 |   230 |       24 |
|    3 |  1980 |        1 |
+------+-------+----------+
3 rows in set (0.04 sec)
```
- sample34 테이블에서 가격과 수량으로 금액을 계산하는 경우를 생각해 보자. 예를 들어 100원 상품 10개 주문시 주문금액은 1000원이 된다.
이는 단가 x 개수 라는 연산식으로 해결 가능
- sample34 테이블에서는 price 가 가격을, quantity 가 수량을 의미. 따라서 계산하는 식은 price * quantity 가 되며 select 구로 지정헤 계산 가능.
- SELECT 구로 금액 계산하기
```text
mysql> select *, price * quantity from sample34;
+------+-------+----------+------------------+
| no   | price | quantity | price * quantity |
+------+-------+----------+------------------+
|    1 |   100 |       10 |             1000 |
|    2 |   230 |       24 |             5520 |
|    3 |  1980 |        1 |             1980 |
+------+-------+----------+------------------+
3 rows in set (0.01 sec)
```

## 3. 열의 별명
- SELECT 결과에서 price * quantity 라고 명명된 열이 금액을 계산한 부분인데 열 이름이 길고 알아보기 여러운 경우에는 열명을 재지정 할 수 있다.
```text
mysql> select *, price * quantity as amount from sample34;
+------+-------+----------+--------+
| no   | price | quantity | amount |
+------+-------+----------+--------+
|    1 |   100 |       10 |   1000 |
|    2 |   230 |       24 |   5520 |
|    3 |  1980 |        1 |   1980 |
+------+-------+----------+--------+
3 rows in set (0.00 sec)
```
- 별명은 예약어 AS를 사용해 지정. SELECT 구에서는 콤마(,)로 구분해 복수의 식을 지정할 수 있으며 각각의 식에 별명을 붙일 수 있다. 
- MySQL에서는 별명을 중복해서 지정해도 에러는 발생하지 않지만 프로그래밍 언어에서 결과값의 처리 방식에 따라 문제가 발생할 수도 있다. 기본적으로 중복되지
않도록 지정한다.
- 키워드 AS 는 생략 가능. 에일리어스(alias)라고도 불리는 별명은 영어, 숫자, 한글 등으로 지정 가능. 단, 한글 지정시 여러 오작동 하는 경우가 많아 더블쿼트
(MySQL에서는 백쿼트)로 둘러싸서 지정. 이 룰은 데이터베이스 객체의 이름에 ASCII 문자 이외의 것을 사용할 경우에 해당.
```text
mysql> select price * quantity "금액" FROM sample34;
+--------+
| 금액   |
+--------+
|   1000 |
|   5520 |
|   1980 |
+--------+
3 rows in set (0.00 sec)
```
> 이름에 ASCII 문자 이외의 것을 포함할 경우는 더블쿼트로 둘러싸서 지정한다!
- 더블쿼트로 둘러싸면 명령구문을 분석할 떄 데이터베이스 객체의 이름이라고 간주한다. 한편 싱글쿼트로 둘러싸는 것은 문자열 상수이다.
- 앞서 '예약어와 같은 이름은 지정할 수 없다'고 했지만 더블쿼트로 둘러싸서 지정하면 사용할 수 있따. 예를 들면 SELECT은 예약어이므로 다음과 같이 별명을
지정해서는 사용할 수 없다.
```text
mysql> select price * quantity SELECT FROM sample34;
ERROR 1064 (42000): You have an error in your SQL syntax; 
check the manual that corresponds to your MySQL server version for the right syntax to use near 
'SELECT FROM sample34' at line 1
```
- 하지만 더블쿼트로 둘러싸면 문제없이 지정 가능.
```text
mysql> select price * quantity "SELECT" FROM sample34;
+--------+
| SELECT |
+--------+
|   1000 |
|   5520 |
|   1980 |
+--------+
3 rows in set (0.00 sec)
```
- 또한 이름을 붙일 때는 숫자로 시작할 수 없다. 수치형 상수를 명령 안에서 사용할 경우에는 쿼트로 묶지 않고 숫자만 입력한다. 이떄 이름이 숫자로 시작한다면
그것이 수치형 상수를 의미하는 것인지 데이터베이스 객체명을 의미하는 것인지 구별할 수 없다.
- 그에 따라 데이터베이스 객체명은 '숫자로 시작해서는 안 된다'는 제약이 생겼다. 물론 이름이 예약어와 겹칠 떄와 마찬가지로 더블쿼트로 묶으면 피할 수 있다.
- 이처럼 MySQL에서는 숫자로 시작하는 객체명이 허용된다. 다만 숫자만으로 구성되는 객체명은 허용되지 않는다. 한편 Oracle 에서는 숫자로 시작하는 이름은
허용되지 않는다. DB마다 차이가 있으니 주의 필요. 더블쿼트로 둘러싸면 객체명으로 간주하는 룰은 표준 SQL에 규정되어 있따.

> 이름을 지정하는 경우 숫자로 시작되지 않도록 한다!

## 4. WHERE 구에서 연산하기
- SELECT 구에 이어, WHERE 구 연산을 알아보자. 구체적이 사례로 sample34 테이블의 '가격 x 수량'으로 금약을 계산해 2000원 이상인 행 검색해보자.
```text
mysql> select *, price * quantity as amount from sample34 where price * quantity >= 2000;
+------+-------+----------+--------+
| no   | price | quantity | amount |
+------+-------+----------+--------+
|    2 |   230 |       24 |   5520 |
+------+-------+----------+--------+
1 row in set (0.01 sec)
```
- WHERE 구의 조건식은 `price * quantity >= 2000`이다. price * quantity 로 금액을 계산해 2000 이상인 행을 검색하라는 뜻. 그 결과 
행은 no가 2인 행 뿐이었다.
- 여기에서 price * quantity 를 계산할 떄 SELECT 구에서 amount 라는 별명을 붙였으므로 WHERE 구에도 amount 로 지정하면 되지 않을까 생각해보지만
그렇게 하면 에러가 발생한다.
```text
mysql> select *, price * quantity as amount from sample34 where amount >= 2000;
ERROR 1054 (42S22): Unknown column 'amount' in 'where clause'
```
### WHERE 구와 SELECT 구의 내부처리 순서
- WHERE 구에서의 행 선택, SELECT 구에서의 열 선택은 데이터베이스 서버 내부에서 WHERE 구 -> SELECT 구의 순서로 처리된다. 
- 서버 내부의 처리순서까지 고려할 필요가 있는 것인지 의문이 들 수도 있지만 SELECT 명령을 이해하기 위해서는 중요한 부분이다.
- 표준 SQL 에는 내부처리 순서가 따로 정해져 있지 않다. 하지만 WHERE 구 -> SELECT 구의 순서로 내부 처리를 하는 데이터베이스가 많다. 따라서 WHERE 구로
행이 조건에 일치하는지 아닌지를 먼저 조사한 후에 SELECT 구에 지정된 열을 선택해 결과로 반환하는 식으로 처리한다.
- 별명은 SELECT 구문을 내부 처리할 떄 비로소 붙여진다. 즉, WHERE 구의 처리는 SELECT 구보다 선행되므로 WHERE 구에서 사용한 별칭은 아직 내부적으로 
지정되지 않은 상태가 되어 에러가 발생하는 것이다.
> SELECT 구에서 지정한 별명은 WHERE 구 안에서 사용할 수 없다.

## 5. NULL 값의 연산
- NULL 값에 'NULL + 1'과 같은 연산을 하면 결과는 어떻게 될까?
- 일부 프로그래밍 언어에서 NULL 은 유효한 값이 없는 상태이므로 0으로 간주해 계산 결과가 1이 될 것이라 생각할 수도 있다.
- 하지만 SQL에서는 NULL 값이 0으로 처리되지 않고 NULL + 1 의 결과값도 NULL이 된다. 다음 연산 결과 또한 모두 NULL이다.
  - NULL + 1
  - 1 + NULL
  - 1 + 2 * NULL
  - 1 / NULL
- 여기서 나눗셈을 보면 NULL 이 0으로 처리되지 않는다는 것을 알 수 있다.
- 통상적인 연산에서 0으로 나누면 'division by zero'에러가 발생할 것. 하지만 1 / NULL 도 NULL 이 된다.
> NULL 로 연산하면 결과는 NULL 이 된다!

## 6. ORDER BY 구에서 연산하기
- ORDER BY 구에서도 연산할 수 있고 그 결괏값들을 정렬할 수 있다. '가격 x 수량'으로 금액을 계산해 값이 큰 순서대로 정렬해보자.
```text
mysql> select *, price * quantity as amount from sample34;
+------+-------+----------+--------+
| no   | price | quantity | amount |
+------+-------+----------+--------+
|    1 |   100 |       10 |   1000 |
|    2 |   230 |       24 |   5520 |
|    3 |  1980 |        1 |   1980 |
+------+-------+----------+--------+
3 rows in set (0.00 sec)

mysql> select *, price * quantity as amount from sample34 order by amount desc;
+------+-------+----------+--------+
| no   | price | quantity | amount |
+------+-------+----------+--------+
|    2 |   230 |       24 |   5520 |
|    3 |  1980 |        1 |   1980 |
|    1 |   100 |       10 |   1000 |
+------+-------+----------+--------+
3 rows in set (0.00 sec)
```
- 이처럼 SELECT 구에서 지정한 별명을 마치 그런 열이 존재하는 것처럼 ORDER BY 구에서 사용할 수 있었따. 한편 WHERE 구에서는 별명을 사용할 수 없었다.
- 서버에서 내부처리가 다음과 같은 순서로 처리되기 떄문.
  - WHERE 구 -> SELECT 구 (여기서 별명 지정) -> ORDER BY 구
> ORDER BY 구에서는 SELECT 구에서 지정한 별명을 사용할 수 있다!

## 7. 함수
- 연산자 외에 함수를 사용해 연산할 수도 있다. 함수는 다음과 같은 문법으로 표기한다.
- 함수
```text
함수명 (인수1, 인수2...)
```
- 연산자는 기호에 따라 연산 방법이 결정된다. 예를 들어 + 기호는 덧셈에 사용됨. 한편 함수는 함수명에 따라 연산 방법이 결정됨. 연산자는 좌우의 항목이 연산 
대상이 된다. 함수는 계산 대상을 인수로 지정. 이떄 인수는 함수명 뒤에 괄호로 묶어 표기. 인수의 수나 구분 방법은 함수에 따라 다르다. 대부분의 함수는 1개
이상의 인수를 가진다. 인수는 파라미터(parameter)라고도 부른다. 또한, 연산자가 그러하듯 함수 역시 결괏값을 반환한다. 이것을 '함수의 반환값'이라고 부른다.
- 사실 연산자도 함수도 둘 다 같은 것이라고 할 수 있다. 다만 표기 방법이 다를 뿐. 여기서는 간단하게 나머지 계산 % 연산자와 동일하게 나머지를 계산하는
MOD 함수를 서로 비교해보자.
- % 연산자는 MySQL 등에서 사용하는 연산자. 10 % 3 은 1이다. MOD 함수는 MySQL 이나 Oracle 등에서 사용하는 함수이다. 함수명이 MOD 이고, 인수로는
나뉘어질 수와 나눌 수의 순으로 2개를 지정. MOD 함수 역시 나머지값을 반환한다. 다음 실행 예를 잘 살펴보면 서로 비슷하다는 것을 알 수 있다.
```text
10 % 3 -> 1
MOD(10, 3) -> 1
```
> 함수도 연산자도 표기 방법이 다를 뿐, 같은 것이다!

## 8. ROUND 함수
- ROUND는 반올림이 필요할 떄 사용.
```text
mysql> select * from sample341;
+---------+
| amount  |
+---------+
| 5961.60 |
| 2138.40 |
| 1080.00 |
+---------+
3 rows in set (0.00 sec)

mysql> select amount, round(amount) from sample341;
+---------+---------------+
| amount  | round(amount) |
+---------+---------------+
| 5961.60 |          5962 |
| 2138.40 |          2138 |
| 1080.00 |          1080 |
+---------+---------------+
3 rows in set (0.00 sec)
```
- INTEGER 형의 경우는 정수밖에 저장할 수 없기 때문에 amount 열은 DECIMAL 형으로 정의했다. DECIMAL 형은 열을 정의할 때 정수부와 소수부의 자릿수를
지정할 수 있는 자료형이다. 다시 말해 소수점을 포함하는 수치를 저장하는 자료형이 된다.

### 반올림 자릿수 지정
- ROUND 함수는 기본적으로 소수점 첫째 자리를 기준으로 반올림한 값을 반환한다. 이떄 ROUND 함수의 두 번쨰 인수로 반올림할 자릿수를 지정할 수 있다.
- 해당 인수를 생략하는 경우는 0으로 간주되어, 소수점 첫째 자리를 반올림한다. 1을 지정하면 둘째 자리를 반올림한다.
```text
mysql> select amount, round(amount, 1) from sample341;
+---------+------------------+
| amount  | round(amount, 1) |
+---------+------------------+
| 5961.60 |           5961.6 |
| 2138.40 |           2138.4 |
| 1080.00 |           1080.0 |
+---------+------------------+
3 rows in set (0.00 sec)
```
- 음수로 지정해 정수부의 반올림할 자릿수도 지정할 수 있다. -1을 지정하면 1단위, -2을 지정하면 10단위 반올림도 할 수 있다. 그 밖에도 반올림 외에
버림을 하는 경우도 있는데 이는 TRUNCATE 함수로 계산할 수 있다.
```text
mysql> select amount, round(amount, -2) from sample341;
+---------+-------------------+
| amount  | round(amount, -2) |
+---------+-------------------+
| 5961.60 |              6000 |
| 2138.40 |              2100 |
| 1080.00 |              1100 |
+---------+-------------------+
3 rows in set (0.00 sec)

mysql> select amount, truncate(amount, 0) from sample341;
+---------+---------------------+
| amount  | truncate(amount, 0) |
+---------+---------------------+
| 5961.60 |                5961 |
| 2138.40 |                2138 |
| 1080.00 |                1080 |
+---------+---------------------+
3 rows in set (0.00 sec)
```
- 이외에도 SIN, COS 등의 삼각함수나 루트를 계산하는 SQRT, 대수를 계산하는 LOG 등 수많은 함수가 제공된다. 또한 합계를 계산할 수 있는 SUM이라는
함수가 있지만 이 함수는 수치를 계산하는 일종의 산술함수로 처리 방식이 좀 다르다.
