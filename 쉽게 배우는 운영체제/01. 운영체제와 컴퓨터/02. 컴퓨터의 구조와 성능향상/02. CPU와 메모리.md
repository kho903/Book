# CPU와 메모리
## 1. CPU의 구성과 동작
### 1.1 CPU의 기본 구성
- 요리사 모형의 요리사 : CPU - 명령어를 해석하여 실행하는 장치
- 산술논리 연산장치(요리), 제어장치(작업 지시), 레지스터(재료 임시 보관)로 구성

#### 산술논리 연산장치
- 데이터를 연산하는 장치
- 데이터의 덧셈, 뺄셈, 곱셈, 나눗셈같은 산술연산.
- AND, OR 같은 논리 연산.

### 제어장치
- 작업을 지시하는 부분

### 레지스터
- 데이터를 임시로 보관하는 곳

### 1.2 CPU의 명령어 처리 과정
C언어 소스코드
```
int D2 = 2, D3 = 3, sum;
sum = D2 + D3;
```
- CPU는 2진수로 이루어진 기계어만 인식하므로 컴파일러를 이용해 기계어로 바꾸어야 한다.
- 어셈블리어는 기계어를 사람이 이해하기 쉬운 기호와 일대일로 대응시켜 기호화한 언어

어셈블러어로 변환한 덧셈프로그램
```
LOAD mem(100), register 2;              // 메모리의 100번지(D2)에 있는 값을 레지스터 2로 가져온다.
LOAD mem(120), register 3;              // 메모리의 120번지(D3)에 있는 값을 레지스터 3로 가져온다.
ADD register 5, register 2, register 3; // 레지스터 2와 레지스터 3에 저장된 값을 더한 결과를 레지스터 5에 넣는다.
MOVE register 5, mem(160);              // 레지스터 5의 값을 메모리의 160번지 (sum)으로 옮긴다.
```
- CPU가 연산을 하려면 필요한 데이터를 CPU로 가져와 임시 보관하는 장소가 레지스터.
- 제어장치는 명령어를 해석하여 제어 신호를 제어 신호를 보내고 CPU 내의 데이터 흐름을 조절하는 역할
  - 위 어셈블리어에서 메모리에서 데이터를 가져오는 것, 덧셈 실행, 덧셈 결과를 메모리로 옮기는 역할

### 1.3 레지스터의 종류
#### 가시 레지스터 (user-visible register)
- 데이터 레지스터 (DR) 
  - 메모리에서 가져온 데이터를 임시 보관, CPU 내의 대부분의 레지스터로, 일반 레지스터 또는 범용 레지스터라고도 부름
- 주소 레지스터 (AR)
  - 데이터 또는 명령어가 저장된 메모리의 주소가 저장됨

#### 특수 레지스터 (user-invisible register)
- 프로그램 카운터 (PC)
  - CPU는 다음에 어떤 명령어를 처리해야 할지 알아야 한다. 다음에 실행할 명령어의 주소를 기억하고 있다가 제어장치에 알려주는 역할
  - 다음에 실행할 명령어의 주소를 가리키기 때문에 명령어 포인터라고도 함
- 명령어 레지스터 (IR)
  - 현재 실행 중인 명령어 저장
- 메모리 주소 레지스터 (MAR)
  - 메모리에서 데이터를 가져오거나 반대로 메모리로 데이터를 보낼 때 주소를 저장하는 역할
- 메모리 버퍼 레지스터 (MBR)
  - 메모리에서 가져온 데이터나 메모리로 옮겨 갈 데이터를 임시로 저장
- 프로그램 상태 레지스터 (PSR)
  - 연산 결과 (양수, 음수 등)를 저장

### 1.4 버스의 종류
- 버스는 CPU와 메모리, 주변장치 간에 데이터를 주고 받을 때 사용
#### 제어 버스
- 다음에 어떤 작업을 할지 지시하는 제어 신호가 오고 감
- 메모리에서 데이터를 가져올 때는 읽기 신호, 처리한 데이터를 메모리로 옮겨 놓을 땐 쓰기 신호를 보냄
- 제어 버스의 신호는 CPU, 메모리, 주변장치와 양방향으로 오고 감

#### 주소 버스
- 메모리의 데이터를 읽거나 쓸 때 어느 위치에서 작업할 것인지 알려주는 위치 정보 (주소)가 오고 감
- 메모리나 주변장치에 데이터를 읽거나 쓸 때 위치 정보를 보내주며, 단방향으로 오고 감

#### 데이터 버스
- 메모리 버퍼 레지스터와 연결된 버스로 데이터의 이동은 양방향으로 오고 감

## 2. 메모리의 종류와 부팅
- 모든 프로그램은 메모리에 올라와야 쓸 수 있는데, 메모리에는 실행에 필요한 프로그램과 데이터 존재, CPU와 협업

### 2.1 메모리의 종류
- 읽거나 쓸 수 있는 램 (RAM, Random Access Memory)과 읽기만 가능한 롬 (ROM, Read Only Memory)로 구분됨

#### 휘발성 메모리
- DRAM(Dynamic RAM)과 SRAM(Static RAM)이 있다.
- DRAM : Dynamic은 시간이 지나면 데이터가 사라지기 때문에 재생이 필요하다는 의미. 즉 일정시간마다 다시 재생시켜야 하는 램
- SRAM : 전력 공급 동안에는 데이터를 보관할 수 있어 재생 불필요. 속도는 빠르지만 비싸다.
- SDRAM : DRAM의 발전된 형태로 SRAM과는 다름. 클록틱 (펄스)이 발생할 때마다 데이터를 저장하는 동기 DRAM

#### 비휘발성 메모리
- 플래시 메모리 (디지털 카메라, MP3, USB 드라이버), FRAM, PRAM 등이 있다.
- 플래시 메모리의 각 소자는 사용횟수가 제한되어 소자 하나당 몇천 ~ 만번정도에 제 기능을 잃어 주의해야 함
- SSD 역시 비휘발성 메모리로, 가격이 비싸지만 빠른 데이터 접근 속도, 저전력, 내구성이 좋다.

#### 롬
- 전력이 끊겨도 데이터를 보관하는 것이 장점이지만, 한번 저장하면 변경 불가.
- 이러한 특성으로 바이오스를 롬에 저장
- 마스크 롬, PROM, EPROM (여러번 쓰고 저장 가능하지만 비싸서 잘 사용 X)

### 2.2 메모리 보호
- 메모리를 보호하기 위해 CPU는 현재 진행 중인 작업의 메모리 시작 주소를 경계 레지스터에 저장한 후 작업.
- 현재 진행 중인 작업이 차지하고 있는 메모리의 크기를 한계 레지스터에 저장
- 사용자 작업 중 두 레지스터의 주소 범위를 범위를 하드웨어적으로 점검함으로써 메모리를 보호한다.
- 메모리 영역을 벗어나서 발생한 인터럽트의 경우 운영체제가 해당 프로그램을 강제 종료 시킨다.

### 2.3 부팅
- 응용 프로그램은 운영체제가 메모리에 올려서 실행. 운영체제는?
- 운영체제를 메모리에 올리는 과정을 부팅이라고 함. 
- 사용자가 컴퓨터 전원을 키면 롬에 저장한 바이오스가 실행. 
- 바이오스는 주요 하드웨어의 제대로 동작하는 지 확인. 이상 있으면 오류메시지 출력. 없으면 하드디스크의 마스터 부트 레코드에 저장된 작은 프로그램을
메모리로 가져와 실행
  - 마스터 부트 레코드는 하드디스크의 첫번째 섹터, 운영체제 실행 코드인 부트스트랩이 저장되어 있음.
    - 부트스트랩 코드는 운영체제를 메모리로 가져와 실행하는 역할을 하는 작은 프로그램
- 부트 스트랩이 메모리에 올라오면 하드디스크에 저장된 운영체제를 메모리로 불러온다.
