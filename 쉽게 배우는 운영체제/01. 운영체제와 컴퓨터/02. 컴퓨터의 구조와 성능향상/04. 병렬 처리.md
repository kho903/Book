# 병렬 처리
## 1. 병렬 처리의 개념
- 병렬 처리는 동시에 여러 개의 명령을 처리하여 작업의 능률을 올리는 방식
- 코어가 여러 개인 CPU는 물론 코어가 하나인 CPU에서도 작동 가능
- 한 주방에서 여러 개의 볶음밥을 동시에 조리하는 것과 같이 CPU 하나의 코어에서 여러 개의 스레드를 이용하는 것과 같은 방식
- 이를 파이프라인 기법이라 하며 스레드는 CPU가 처리할 수 있는 작업의 단위. 여러 개의 스레드를 동시에 처리하는 방법은 멀티스레드라 함.

## 2. 병렬 처리 시 고려 사항
### 상호 의존성이 없어야 병렬 처리가 가능하다.
- 각 명령이 서로 독립적이고 앞의 결과가 뒤의 명령에 영향을 미치지 않아야 한다는 뜻
- 앞뒤 단계 간에 상호 의존적인 명령어를 사용하면 병렬 처리를 할 수 없다.

### 각 단게의 시간을 거의 일정하게 맞춰야 병렬 처리가 원만하게 이루어진다.
- 단계별 시간의 차이가 크면 가장 긴 시간이 걸리는 단계에서 병목 현상이 발생하여 진행이 전반적으로 밀려 작업시간이 늘어난다.
- 따라서 병렬 처리의 효과가 떨어진다.

### 전체 작업 시간을 몇 단계로 나눌 지 잘 따져보아야 한다.
- 병렬 처리에서 작업을 N개로 쪼갰을 때 N을 병렬 처리의 깊이라고 한다.
- 이론적으로 N이 커질수록 동시에 작업할 수 있는 개수가 많아져서 성능이 높아지지만 너무 많이 나누면 각 단계마다 이동하고 불러오는
시간이 너무 많이 걸리는 오버헤드가 발생할 수 있다.
- 따라서 보통 병렬 처리의 깊이를 10~20 정도로 한다.

## 3. 병렬 처리 기법
- CPU 내에서 명령어는 제어장치가 처리. 제어장치는 명령어 해석, 실행, 결과 저장 반복 -> 이러한 과정 전체가 하나의 스레드
- CPU에서 명령어가 실행되는 과정
1. 명령어 패치 : 다음에 실행할 명령어를 명령어 레지스터에 저장
2. 명령어 해석
3. 실행 : 해석한 결과를 토대로 명령어 실행
4. 쓰기 : 실행된 결과를 메모리에 저장
- 병렬 처리 기법은 하나의 코어에서 작업을 병렬로 처리하는 파이프라인 기법, 여러 코어 사용해 동시 진행하는 슈퍼 스칼라 기법으로 나뉨
- 이외에도 슈퍼 파이프라인 기법, 슈퍼파이프라인 슈퍼스칼라 기법, VLIW 기법등이 존재

### 3.1 파이프라인 기법
- CPU 사용 극대화위해 명령을 겹쳐서 실행. 하나의 코어에 여러 개의 스레드 사용
- 하드웨어를 독립적으로 구성하여 명령어 분할, 동시에 처리
- 여러가지 문제가 있고, 이를 파이프라인의 위험이라고 부른다.
#### 데이터 위험
- 데이터의 의존성 때문에 발생. 동시에 실행되는 스레드 내에서 뒤의 명령어가 앞의 데이터를 사용하게 될 때, 동시 실행되어서는 안됨.
- 명령어 단계를 지연하여 해결

#### 제어 위험
- 분기 if문, 바로가기의 goto문에서 발생
- 현재 동시에 처리되고 있는 명령어들이 쓸모없어질 수 있음. 분기 예측이나 분기 지연 방법으로 해결

#### 구조 위험
- 서로 다른 명령어가 같은 자원에 접근하려 할 때 발생하는 문제
- 해결하기 어렵다.

### 3.2 슈퍼스칼라 기법
- 파이프라인을 처리할 수 있는 코어를 여러 개 구성하여 복수의 명령어가 동시에 실행되도록 하는 방식
- 파이프라인과 대부분 비슷. 코어를 2개 구성하여 각 단계에서 동시에 실행되는 명령어가 2개
- 명령어가 상호 의존성 없이 독립적이어야 하며, 이를 위한 처리도 컴파일러에서 이루어지도록 조정해야 함
- 오늘날의 대부분 CPU가 선택한 기법

### 3.3 슈퍼파이프라인 기법
- 파이프라인 기법을 강화한 것
- 각 단계를 세분하여 한 클록 내에 여러 명령어 처리 가능
- 빠른 시간안에 다음 명령어 시작할 수 있어, 병렬 처리 능력 향상
- 크레이 슈퍼컴퓨터의 CPU에서 사용

### 3.4 슈퍼파이프라인 슈퍼스칼라 기법
- 앞의 병렬 처리 기법을 모두 합쳐 놓은 것
- 슈퍼파이프라인 기법을 여러 개의 코어에서 동시에 수행하는 방식

### 3.5 VLIW 기법
- 앞의 기법들과 전혀 다른 방식, 앞의 방식들은 병렬 처리를 지원하는 하드웨어적인 방법.
- VLIW는 CPU가 병렬 처리를 지원하지 않을 경우 소프트웨어적으로 병렬 처리를 하는 방법
- 동시에 수행할 수 있는 명령어들을 컴파일러가 추출하고 하나의 명령어로 압축하여 실행
- 컴파일 시 병렬 처리가 이루어짐
