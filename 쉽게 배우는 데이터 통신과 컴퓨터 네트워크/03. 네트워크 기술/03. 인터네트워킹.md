# 3.3 인터네트워킹
- 라우팅 장비는 네트워크 내부에서 경로 선택 기능을 수행하는데, 둘 이상의 서로 나른 네트워크를 연결하는 기능을 인터네트워킹(Internetworking)이라 함. 예를 들어 인터넷은 IP 주소를 기반으로 최적의 경로를
선택함. 인터네트워킹을 지원하려면 연결되는 네트워크의 차이를 분석해, 전송 데이터를 적절히 중개할 수 있어야 함. 헤더 정보 등의 프로토콜이 상이하거나 물리 계층에서 전송 매체의 특성이 다르면 이를 변환하는
기능이 필요함.
- 2개의 네트워크를 연결하는 장비는 역할이 어느 계층에 속하느냐에 따라 종류가 달라짐. 일반적으로 하위 3개 계층인 물리, 데이터 링크, 네트워크 계층의 기능을 수행하며, 특별히 네트워크 계층까지의 기능을 수행하는
장비는 라우터(Router).
- 네트워크 간의 차이는 다양한 방법으로 기술 가능. 예를 들어, 연결형/비연결형 서비스, 데이터 전송에 사용되는 프로토콜의 종류, 호스트를 구분하기 위한 주소 표현 방법, 전송 패킷의 크기, 멀티캐스팅/브로드캐스팅의
지원 여부 등이 고려 대상.
- 두 LAN을 연결하려면 중간에 있는 네트워크 장비가 데이터를 중개해야 함. 네트워크 장비의 기능에 따라(네트워크 장비의 네트워크 계층, 데이터 링크 계층, 물리 계층의 기능에 따라) 양쪽 LAN은 특성이 다를 수 
있으며, 네트워크 장비 하나에 여러 종류의 LAN을 연결할 수도 있음.
- 네트워크 장비는 수행 기능에 따라 리피터, 브리지, 라우터로 구분함. 데이터 링크 계층은 MAC 계층과 LLC 계층으로 나뉘며 MAC 계층이 하위, LLC 계층은 상위에 위치함.

### 리피터 (Repeater)
- 리피터는 물리 계층의 기능을 지원함. 양쪽 단의 물리적인 특성이 같으면 한쪽 단에서 들어온 비트 신호를 증폭해 다른 단으로 단순히 전달하는 역할을 함.
- 한쪽이 유선 환경이고 다른쪽이 무선 환경인 경우도 있고, 유무선의 특성도 다양함. 따라서 단순한 신호 증폭뿐만 아니라, 필요한 경우에 신호 변환 작업도 이루어짐.

### 브리지 (Bridge)
- 브리지는 물리 계층을 포함해 데이터 링크 계층의 기능 지원. 한쪽 단에서 들어온 프레임의 MAC 계층 헤더를 다른 단의 MAC 계층 헤더로 변형해 전송할 수 있어 종류가 다른 LAN 연결 가능.
- 브리지가 수신한 프레임의 수신 호스트 주소와 송신 호스트 주소가 같은 LAN에 소속되어 있으면 브리지는 아무 행동도 하지 않음. 그러나 송수신 호스트의 위치가 서로 다른 LAN에 속하면 중개 기능을 수행. 따라서 
브리지는 리피터보다 LAN과 LAN 사이의 불필요한 트래픽 발생을 억제 가능.

### 라우터 (Router)
- 라우터는 물리 계층, 데이터 링크 계층, 네트워크 계층의 기능 지원. 네트워크 계층의 라우팅 기능을 수행할 수 있어 여러 포트를 사용해 다수의 LAN을 연결하는 구조를 지원함.
- 수신한 패킷을 해석해 적절한 경로로 전송하도록 경로를 배정하는 기능을 하며, 인터넷은 IP 주소를 기반으로 경로 선택을 함.
- 브리지는 제한된 형태로 중개 기능을 수행하지만, 라우터는 네트워크 전체 구조를 고려한 일반적인 라우팅 기능을 수행함.


- 일반적으로 상위 계층의 개념인 게이터웨이(Gateway)는 서로 다른 응용 환경을 지원하기 위해 사용할 수 있으므로, 네트워크 양단의 특성이 다른 환경에서 중개하는 역할을 함.

## 1. 브리지 (Bridge)
- 브리지의 좌우에 위치하는 LAN은 종류가 같을 수도 있고, 다를 수도 있음. 예를 들어, 양쪽 LAN이 모두 이더넷을 사용하면 프레임 헤더를 해석하는 간단한 작업으로 쉽게 중개 가능. 하지만, 종류가 다르면 프레임
변환 등 복잡한 과정 필요.
- 브리지를 이용해 LAN과 LAN 사이에서 데이터를 중개할 때 각 LAN에서 사용하는 MAC 계층이 다를 수 있음. 예로, LAN1은 이더넷, LAN2는 토큰링을 사용한다면 브리지에 MAC 헤더를 해석해 변환하는 기능이 필요.
즉, LAN1로부터 데이터를 수신할 때는 해당 MAC 계층 헤더를 해석하고 제거해야 함. 그러면 브리지의 최상위 계층에서는 MAC 헤더가 제거되고 LLC 헤더까지 포함된 데이터만 남음. 반대로 LAN2로 전송할 때는 해당
LAN의 MAC 계층에 맞도록 헤더 정보를 적절히 추가해야 함.
- 위 예는 브리지에 연결된 LAN이 2개인 경우지만, 브리지는 더 많은 LAN을 동시에 연결 가능해 연결된 LAN의 종류만큼 MAC 계층과 물리 계층을 해석할 수 있어야 함.
- 브리지는 동작 방식에 따라 트랜스페런트 브맂지와 소스 라우팅 브리지로 나뉨.

### 트랜스페런트 브리지 (Transparent Bridge)
- 트랜스패런트 브리지는 이름처럼 라우팅 기능이 투명하게 보이기 때문에 라우팅 작업이 사용자의 부담 없이 이루어짐. 브리지 사용자는 전송하는 프레임 헤더에 라우팅 정보를 추가하지 않아도 되며, 필요한 라우팅 과정은
브리지가 자동으로 수행함. 설치 과정에서 하드웨어의 조정이나 소프트웨어의 변경, 주소, 라우팅 테이블 관련 사항을 고려할 필요가 없음.
- 브리지에 연결된 임의의 LAN으로부터 프레임이 도착했을 때, 브리지가 수행하는 동작은 다음 두 가지 중 하나.
  - 첫째, 해당 프레임의 수신 호스트가 송신 호스트와 동일한 방향에 위치한 경우에는 프레임을 중개하는 과정이 필요 없어 무시해도 됨.
  - 둘째, 프레임의 수신 호스트가 송신 호스트와 다른 방향에 위치한 경우, 수신 호스트가 있는 방향으로 프레임을 중개해야 함. 이 과정에서 브리지 내부에는 송수신 호스트가 동일한 방향에 있는지와 수신 호스트가
    브리지의 어느 방향에 위치하는지에 대한 정보가 있어야 함.
- 수신한 프레임을 무시할지, 다른 LAN으로 전달할지는 전적으로 브리지의 라우팅 테이블을 근거로 판단함. 라우팅 테이블의 정보는 각 호스트가 어느 포트에 연결되어 있는지를 나타냄.

#### 라우팅 테이블 (Routing Table)
- 트랜스페런트 브리지가 제대로 동작하려면 라우팅 테이블 접오가 정확해야 함. 라우팅 테이블은 LAN이 동작하면서 자동으로 생성되는데, 이 과정을 요약하면 다음과 같다.
- 먼저 브리지에 전원이 들어오면 라우팅 테이블의 내용이 비어, 초기에는 프레임의 수신 호스트가 어느 쪽 포트에 위치하는지 판단 불가. 그러므로 이 경우, 플러딩 (Flooding) 알고리즘을 사용해 입력된 프레임을
브리지의 모든 포트 방향으로 전달함. 물론, 프레임이 들어온 방향으로는 전달하지 않음.
- 플러딩 알고리즘에 동작 과정에서 브리지에 입력된 프레임의 송신 호스트 주소를 근거로 송신 호스트가 몇 번 포트에 연결되었는지 알 수 있음. 예를 들어 2번 포트로 받은 프레임의 송신 호스트 주소가 c이면, 호스트
c는 2번 포트에 연결되어 있다고 판단할 수 있음. 이와 같이 데이터 전달 과정에서 얻은 프레임의 송신 호스트 주소와 포트 번호의 정보를 라우팅 테이블에 반영함.
- 위 방법을 사용하면 시간이 경과함에 따라 라우팅 테이블의 정보가 계속 누적되므로 라우팅 정보를 효과적으로 수집 가능. 또 호스트의 연결 위치를 변경해도 라우팅 정보를 자동으로 갱신 가능. 이처럼 네트워크의 동작
과정에서 라우팅 정보를 얻는 방식을 역방향 학습(Backward Learning) 알고리즘이라 함.
- 호스트의 위치가 바뀌어 라우팅 정보가 변경되면 가장 최근 정보로 수정해주어야 함. 

#### 스패닝 트리
- 역방향 학습 알고리즘을 이용하면 라우팅 정보를 효과적으로 얻을 수 있지만 네트워크에 이중 경로가 존재하면 잘못된 라우팅 정보를 얻게 됨.
- 이런 문제접을 해결하려면 이중 경로가 존재하지 않도록 네트워크를 설계해야 함. 네트워크의 설계 과정에서 순환 구조가 불가피하게 만들어지면 네트워크의 논리적인 연결 상태를 비순환 형태로 간주함으로써, 역방향
알고리즘이 올바르게 동작해야 함. 네트워크의 비순환 구조를 스패닝 트리(Spanning Tree)라 하고, 이를 지원하는 알고리즘을 스패닝 트리 알고리즘이라 함.
- 스패닝 트리를 구성하려면 먼저 임의의 브리지를 트리 구조의 최상위 브리지인 루트(Root)로 지정해야 함. 이를 위해 브리지가 자신의 고유 번호를 서로 공개함으로써, 번호가 가장 낮은 브리지를 루트로 선정 가능.
그 다음, 다른 모든 브리지까지의 최단 경로 트리를 구성하는 방식으로 LAN을 구축하는 과정을 밟음.

### 소스 라우팅 브리지 (Source Routing Bride)
- 트랜스페런트 브리지는 공유 버스에서 구현되는 CSMA/CD (Carrier Sense Multiple Access/Collision Detection) 방식과 토큰 버스 방식에서 사용. 사용자 입장에서 보면 간편하지만 효율적이지 못하다는
단점 존재.
- 일반적으로 소스 라우팅 브리지는 링 구조의 네트워크에서 사용함. 이 방식은 이름처럼 프레임이 수신 호스트까지 도달하기 위한 라우팅 정보를 송신 호스트가 제공함. 즉, 송신 프레임 내부에 수신 호스트까지 도달하기
위한 모든 경로를 기술함으로써, 중간 브리지에 필요한 라우팅 정보가 프레임 자체에 포함된, 프레임을 수신한 브리지는 이 정보를 이용해 프레임을 적절한 경로로 전달함.

## 2. IP 인터네트워킹
- 인터넷 환경에서 IP 프로토콜을 사용해 IP 인터네트워킹을 지원하려면 송수신 호스트 간의 여러 네트워크 인터페이스를 거쳐 패킷을 전달할 수 있어야 함. 인터넷에서 라우팅 기능을 수행하는 네트워크 계층은 IP
프로토콜임. 따라서 인터넷에 연결된 모든 시스템은 공통으로 IP 프로토콜을 지원해야 하며, 하위의 데이터 링크 계층에는 다양한 종류가 존재함.
- 라우터 A가 이더넷 인터페이스와 PPP 인터페이스를 지원하고, 라우터 B는 PPP, ATM 인터페이스를 지원한다고 가정하자. 이들을 이용해 이더넷과 ATM이라는 상이한 네트워크 인터페이스를 지원하는 사용자 간의 연결
구조가 가능함을 알 수 있음. 하위의 데이터 링크 계층이 다르기 때문에 라우터는 라우팅 과정에서 경로 선택뿐만 아니라, 이더넷과 PPP, 혹은 PPP와 ATM 프로토콜의 프레임 구조를 변환하는 기능도 수행해야 함.
- 패킷을 올바르게 중개하기 위해 라우터들은 IP 프로토콜 기능을 지원하고, 양 끝단의 송수신 호스트는 TCP/IP 응용 프로그램을 이용해 통신함. 실제 인터넷을 수많은 라우터가 복잡하게 연결된 구조를 갖고 있으며,
IP 주소를 기반으로 라우팅 처리가 이루어짐.
- 라우터에는 양쪽 MAC 계층의 프레임 구조에 차이가 있을 때 이를 변환하는 기능이 필요함. 위 예에서 라우터 A는 입력된 이더넷 헤더를 PPP 헤더로 변환하고, 라우터 B는 PPP 헤더를 ATM 헤더로 변환해주어야 함.
라우터에 연결된 네트워크가 동일한 종류의 MAC 계층을 사용하면 MAC 헤더의 변환 과정은 이루어지지 않음.
- 헤더 변환 과정과 별도로, 라우터를 거치는 동안에 전송되는 데이터가 특정 MAC 계층에서 전송하기에 너무 크면 전손 데이터의 분할과 병합 과정이 이루어짐. 즉, 각각의 MAC 계층은 한 번에 전송할 수 있는 프레임
데이터의 최대 크기가 정해져 있으며, 이 크기는 MAC 계층마다 다르게 정의됨. 따라서 AMC 계층과 네트워크 계층의 전송 데이터에 대한 분할과 병합은 네트워크의 중요한 주제 중 하나.

## 3. 인터넷 라우팅
- 라우터의 역할은 수신된 IP 패킷을 최적의 경로로 전달하는 것. 그러려면 인터넷의 전체 구성과 현재 상태에 대한 정보를 활용해 경로를 선택해야 함.
- 대표적인 라우팅 방식으로 고정 경로 배정과 적응 경로 배정이 있음.

### 고정 경로 배정 (Fixed Routing)
- 고정 경로 배정은 간단한 구현만으로도 효과적인 라우팅이 가능한 방법으로, 송수신 호스트 사이에 고정불변의 경로를 배정함. 단점은 전송 경로가 고정되므로 트래픽 변화에 따른 동적 경로 배정이 불가능.
- 그러나 송수신 호스트 사이의 트래픽을 미리 측정해 고정 경로를 적절히 배정하면 간단하고 효율적인 라우팅이 가능.
- 라우팅 테이블의 값은 목적지 네트워크의 주소와 해당 목적지로 향하는 경로 위에 있는 다음 라우터의 주소. 일반적으로 라우팅 경로를 결정할 때는 거쳐야 하는 라우터의 수를 최소화하는 경우와 실제 목적지까지
도착하는 데에 걸리는 시간이 가장 짧은 경우가 가능.

### 적응 경로 배정 (Adaptive Routing)
- 고정 경로 배정 방식에서 라우팅 테이블의 경로 정보 변경은 네트워크 구성이 변경된 경우에만 가능. 인터넷에서 사용되는 라우터는 적응 경로 배정 방식을 채택함.
- 적응 경로 배정에서는 네트워크의 연결 상태가 변하면 이를 패킷의 전달 경로에 반영. 이때 결정에 영향을 주는 요소는 크게 두 가지. 하나는 특정 네트워크나 라우터가 정상적으로 동작하지 않는 경우이고, 다른 하나는
네트워크의 특정 위치에서 혼잡이 발생하는 경우임.
- 네트워크 현재 상태가 경로 배정에 영향을 주는 적응 경로 배정에서 현재 상태가 반드시 실시간을 의미하는 것은 아님. 실제 인터넷에서 실시간으로 네트워크의 현재 상태를 모두 파악하는 것은 사실상 불가능.
- 적응 경로 배정은 이론적인 타당성에도 불구하고, 가볍게 넘길 수 없는 단점 존재. 경로를 결정하는 과정이 복잡해지면 이를 처리하는 라우터의 부담이 증가하는데, 인터넷처럼 복잡하고 거대한 네트워크에서 이것은
인터넷 자체의 트래픽 증가에 많은 영향을 줌. 따라서 인터넷에서 라우팅 정보의 수집은 비실시간적으로 제한된 형태로 적용됨.
- 네트워크에서의 변화는 내부적으로 상태 정보에 대한 처리를 수반. 그러나 특정 위치에서 어떤 변화가 발생했을 때 네트워크의 모든 라우터에 동시에 반영하는 것은 현실적으로 불가능해, 라우터들끼리 정보의 불일치성
(Inconsistency) 현상이 발생할 수 있음. 불일치성을 해소하려면 라우터 사이의 정보 교환이 빠르게 자주 이루어져야 하지만 이는 네트워크의 트래핏을 높이는 요인이 되어, 결과적으로 라우터의 처리 부담 증가.

### 자율 시스템 (Autonomous System)
- 라우팅 프로토콜과 관련해 자율 시스템이라는 개념 존재. 자율 시스템은 다수의 라우터로 구성할 수 있으며, 라우터들은 서로 공통의 라우팅 프로토콜을 사용해 정보를 교환함. 자율 시스템은 동일한 라우팅 특성에 의해
동작하는 논리적인 단일 구성체.
- 자율 시스템 내부에서 사용하는 공통 프로토콜을 내부 라우팅 프로토콜 (IRP, Interior Routing Protocol)이라 하며, 라우터들끼리 라우팅 정보를 교환하는 용도로 사용함. 예를 들어 특정 대학교 내부에서
운영하는 네트워크를 하나의 자율 시스템이라 할 수 있으며, 그 안에 존재하는 라우터들은 내부 라우팅 프로토콜애 의해 동작함.
- 학교 같은 인터넷 환경에서는 각 건물을 라우터로 연결해 하나의 자율 시스템을 구성할 수 있고, 외부의 자율 시스템과도 연결 가능. 이러한 구조에서는 서로 다른 자율 시스템끼리 사용하는 알고리즘과 라우팅 테이블
정보의 구조가 서로 다를 수 있으므로, 자율 시스템 사이의 연동을 위한 방안을 고려해야 함. 자율 시스템들 간에 사용하는 라우팅 프로토콜을 일반적으로 외부 라우팅 프로토콜 (ERP, Exterior Routing
Protocol) 이라 함.
- 동일한 자율 시스템에 위치한 라우터 사이에는 내부 라우팅 프로토콜을 사용하고, 서로 다른 자율 시스템을 연결하는 라우터 사이에는 외부 라우팅 프로토콜을 사용함. 인터넷에서 사용하는 내부 라우팅 프로토콜에는
RIP, OSPF 등이 있고, 외부 라우팅 프로토콜에는 BGP 등이 있음.
