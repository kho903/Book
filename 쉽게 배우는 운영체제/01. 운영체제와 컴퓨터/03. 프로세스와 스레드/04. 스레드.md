# 스레드
## 1. 스레드의 개념
### 1.1 스레드의 정의
- 프로세스의 코드에 정의된 절차에 따라 CPU에 작업 요청을 하는 실행 단위이다.
- 프로세스는 요리 작업 전체, 스레드는 요리를 완성하기 위해 수행하는 각각의 조리에 해당
- 작은 단위의 일(operation)이 모여 하나의 작업(task)이 된다.
- 작업 크기순으로 job > task > operation, 이는 처리(job) > 프로세스(task) > 스레드(operation). 여러 개의 스레드가 모여 프로세스, 
여러 개의 프로세스가 모여 처리가 되며, 여러 개의 프로세스를 모아 한꺼번에 처리하는 방법을 일괄 작업 (batch job)이라 한다.

### 1.2 프로세스와 스레드의 차이
- 프로세스끼리는 약하게 연결, 스레드끼리는 강하게 연결되어 있다.
- 코스요리를 이루는 개별 요리는 프로세스에 해당하고 프로세스끼리는 약하게 연결. 프로세스는 여러 개의 스레드로 구성되고, 스레드끼리는 강하게 연결.
한가지 요리의 조리 순서에 해당.

#### 멀티태스크
- 워드프로세서와 프린터 스풀러는 서로 독립적으로 작동하다가 필요할 때 출력할 데이터를 주고받는다. 서로 독립적인 프로세스는 데이터를 주고받을 때 
프로세스간 통신 (Inter Process Communication, IPC)을 이용한다.

#### 멀티스레드
- 워드프로세서를 예를 들면, 프로세스 내의 문서 편집, 문서 입출력, 맞춤법 검사, 그림판 같은 스레드들이 동시에 작업을 하는 것.
- 강하게 연결되어 있어 워드프로세서 종료 시, 프로세스 내의 스레드도 강제종료. 변수나 파일을 공유하고 전역 변수나 함수 호출등의 방법으로 스레드 간 통신

### 1.3 스레드 관련 용어
#### 멀티스레드
- 프로세스 내 작업을 여러 개의 스레드로 분할함으로써 작업의 부담을 줄이는 프로세스 운영 기법

#### 멀티태스킹
- 운영체제거 CPU에 작업을 줄 때 시간을 잘게 나누어 배분하는 기법
- 이러한 시스템을 시분할 시스템(time-sharing system)이라 한다.
- 시분할 시스템에서 운영체제가 CPU에 전달하는 작업은 프로세스가 아니라 스레드

#### 멀티프로세싱
- CPU를 여러 개 사용하여 여러 개의 스레드를 동시에 처리하는 작업 환경.
- 네트워크로 연결된 여러 컴퓨터에 스레드를 나누어 협업하는 분산 시스템도 멀티프로세싱이라 부름

#### CPU 멀티스레드
- 한 번에 하나씩 처리해야 하는 스레드를 파이프라인 기법을 이용하여 동시에 여러 스레드를 처리하도록 만든 병렬 처리 기법
  - 멀티스레드 : 운영체제가 소프트웨어적으로 프로세스를 작은 단위의 스레드로 분할하여 운영하는 기법
  - CPU 멀티스레드 : 하드웨어적인 방법으로 하나의 CPU에서 여러 스레드를 동시에 처리하는 병렬 처리 기법

## 2. 멀티스레드의 구조와 예
### 2.1 멀티스레드의 구조
- 여러 개의 작업을 동시에 진행하는 작업에서 fork() 시스템 호출로 여러 개 만들 경우 코드 일부, 프로세스 제어 블록, 공유 변수가 메모리의 여러 곳에 중복되어 
메모리가 낭비됨.
- 스레드는 이러한 멀티태스킹의 낭비 요소를 제거하기 위해 사용됨. 비슷한 일을 하는 2개의 프로세스를 만드는 대신 코드, 데이터 등을 공유하면서 여러 개의 일을 하나의
프로세스 내에서 하는 것
- 프로세스는 정적인 영역(프로세스가 실행되는 동안 바뀌지 않는 영역), 동적인 영역(스레드가 작업을 하면서 값이 바뀌거나 새로 만들어지거나 사라지는 영역
: 레지스터 값, 스택 힙 등)으로 구분.
- 프로세스 하나에 스레드 하나의 경우 여러 작업을 하려면 fork() 시스템 호출로 여러 개의 프로세스를 만들어야 했지만 오늘날엔 여러 개의 스레드를 만들어 사용
- fork() 시스템 호출 시 여러 개 프로세스를 만들면 필요 없는 정적 영역이 여러 개가 되어, 이 문제 해결을 위해 하나의 프로세스 내에 여러 개의 스레드를
생성하는 멀티스레드는 코드, 파일 등의 자원을 공유하여 자원 낭비를 막고 효율성 향상시킴.

## 3. 멀티스레드의 장단점
### 3.1 멀티스레드의 장점
1. 응답성 향상 : 한 스레드가 입출력으로 인해 작업이 진행되지 않더라도 다른 스레드가 작업을 계속하여 사용자의 작업 요구에 빨리 응답 가능
2. 자원 공유 : 한 프로세스 내에서 독립적인 스레드를 생성하면 프로세스가 가진 자원을 모든 스레드가 공유하게 되어 작업 원할
3. 효율성 향상 : 여러 개의 프로세스를 생성하는 것과 달리 멀티스레드는 불필요한 자원의 중복을 막음으로써 시스템 효율 향상
4. 다중 CPU 지원 : 2개 이상의 CPU를 가진 컴퓨터에서 멀티스레드를 사용하면 다중 CPU가 멀티스레드를 동시에 처리하여 CPU 사용량이 증가하고
프로세스의 처리 시간이 단축됨

### 3.2 멀티스레드의 단점
- 여러 개의 프로세스를 사용하는 것이 낭비 요소가 되어 멀티스레드를 사용하는 것이 단점으로 작용할 수 있음
- 모든 스레드가 자원을 공유해 한 스레드가 문제가 생기면 전체 프로세스에 영향을 미침
- 반면 프로세스를 여러 개 만드는 방식의 경우 각 프로세스가 독립적이기 떄문에 한 프로세스의 문제가 다른 프로세스로 전달되지 안흥ㅁ

## 4. 멀티스레드 모델
- 커널 스레드 : 커널이 직접 생성하고 관리하는 스레드
- 사용자 스레드 : 라이브러리에 의해 구현된 일반적인 스레드

### 4.1 사용자 레벨 스레드
- 운영체제가 멀티스레드를 지원하지 않을 때 사용되는 방법, 초기의 스레드 시스템
- 라이브러리를 사용하여 구현, 커널이 지원하는 스케줄링, 동기화 같은 기능 대신 구현 - 커널에서는 하나의 프로세스처럼 보임
- 사용자 프로세스 내에 여러 개의 스레드가 존재하지만 커널의 스레드 하나와 연결되어 1 to N 모델이라 부름
- 문맥 교환 필요 X
- 단점
  - 여러 개의 스레드가 하나의 커널 스레드가 연결되기 때문에 커널 스레드가 입출력 작업을 위해 대기 상태에 들어가면 모든 사용자 스레드가 같이 대기
  - 한 프로세스의 타임 슬라이스를 여러 스레드가 공유하기 떄문에 여러 개의 CPU 동시에 사용 불가
  - 보안에 취약

### 4.2 커널 레벨 스레드
- 커널이 멀티스레드를 지원하는 방식, 하나의 사용자 스레드가 하나의 커널 스레드와 연결되기 때문에 1 to 1 모델이라 부름
- 사용자 레벨 스레드와 장단점이 반대.
- 멀티 CPU 사용 가능. 하나의 스레드가 대기 상태에 있어도 다른 스레드 작업 가능. 보안에 강하고 안정적으로 작동
- 문맥 교환을 할 때 오버헤드로 인해 상대적으로 느림

### 4.3 멀티레벨 스레드
- 멀티레벨 스레드 또는 하이브레드 스레드는 사용자 레벨 스레드와 커널 레벨 스레드를 혼합한 방식으로 M to N 모델
- 사용자 레벨 스레드와 커널 레벨 스레드의 장단점을 모두 가지고 있다.
- 하나의 커널 스레드가 대기 상태에 들어가면 다른 커널 스레드가 대신 작업을 하여 사용자 레벨 스레드보다 유연하게 작업 처리.
- 커널 레벨 스레드를 같이 사용하여 문맥 교환 오버헤드 존재
- 따라서 빠르게 움직여야 하는 스레드는 사용자 레벨 스레드로 동작, 안정적으로 움직여야 하는 스레드는 커널 레벨 스레드로 동작
