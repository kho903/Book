# 4-2. 두 테이블을 묶는 조인
- 조인(join)이란 두 개의 테이블을 서로 묶어서 하나의 결과를 만들어 내는 것. 두 테이블을 엮어야만 원하는 형태가 나오는 경우도 많음.

## 내부 조인
- 두 테이블을 연결할 때 가장 많이 사용하는 것이 내부 조인. 그냥 조인이라 부르면 대부분 내부 조인을 의미.

### 일대다 관계의 이해
- 두 테이블의 조인을 위해서는 테이블이 일대다(one to many) 관계로 연결되어야 함. 
- 데이터베이스의 테이블은 하나로 구성되는 것보다 여러 정보를 주제에 따라 분리해서 저장하는 것이 효율적. 이 분리된 테이블은 서로 관계를 맺음. 이러한 대표적인 사례가 market_db의 회원, 구매 테이블.
- market_db의 회원 테이블의 아이디와 구매 테이블의 아이디는 일대다 관계. 일대다 관계란 한쪽 테이블에는 하나의 값만 존재해야 하지만, 연결된 다른 테이블에는 여러 개의 값이 존재할 수 있는 관계를 말함.
- 예를 들어 회원 테이블의 아이디 'BLK'는 1개(1, one). 그래서 회원 테이블의 아이디를 기본 키(PK)로 지정했음. 구매 테이블의 아이디에서는 3개의 'BLK'를 찾을 수 있음. 즉, 회원은 1명이지만 이 회원은
구매를 여러 번(다, many)할 수 있는 것. 그래서 구매 테이블의 아이디는 외래 키(Foreign Key, FK)로 지정.
- 일대다 관계는 현실 세계에서 예로 들면, 회사원 테이블과 급여 테이블, 학생 테이블과 학점 테이블을 볼 수 있음.

### 내부 조인의 기본
- 내부 조인(inner join)은 조인 중에서 가장 많이 사용됨. 3개 이상의 테이블로도 할 수 있지만 대부분은 2개로 조인.
- 형식은 다음과 같음.
```text
select <열 목록>
from <첫 번째 테이블>
    inner join <두 번째 테이블>
    on <조인될 조건>
[where 검색 조건]
```
- 여기서 inner join을 그냥 join이라고 써도 inner join으로 인식.
- 구매 테이블에는 물건을 구매한 회원의 아이디와 물건 등의 정보만 존재. 이 물건을 배송하기 위해서 구매한 회원의 주소 및 연락처를 알아야 함. 이 회원의 주소, 연락처를 알기 위해 정보가 있는 회원 테이블과
결합하는 것이 내부 조인.
- 구매 테이블에서 GRL이라는 아이디를 가진 사람이 구매한 물건을 발송하기 위해 다음과 같이 조인해서 검색 가능.
```text
mysql> select * from buy
    -> inner join member
    -> on buy.mem_id = member.mem_id
    -> where buy.mem_id = 'GRL';
+-----+--------+-----------+------------+-------+--------+--------+--------------+------------+--------+--------+----------+--------+------------+
| num | mem_id | prod_name | group_name | price | amount | mem_id | mem_name     | mem_number | addr   | phone1 | phone2   | height | debut_date |
+-----+--------+-----------+------------+-------+--------+--------+--------------+------------+--------+--------+----------+--------+------------+
|   7 | GRL    | 혼공SQL   | 서적       |    15 |      5 | GRL    | 소녀시대     |          8 | 서울   | 02     | 44444444 |    168 | 2007-08-02 |
+-----+--------+-----------+------------+-------+--------+--------+--------------+------------+--------+--------+----------+--------+------------+
1 row in set (0.00 sec)
```
- 두 개 테이블을 조인하는 경우 동일한 열 이름이 존재한다면 꼭 테이블_이름.열_이름 형식으로 표기해야 함.
- 이 과정을 살펴보자.
1. 구매 테이블의 mem_id(buy.mem_id)인 'GRL'을 추출.
2. 'GRL'과 동일한 값을 회원 테이블의 mem_id(member.mem_id)열에서 검색.
3. 'GRL'이라는 아이디를 찾으면 구매 테이블과 회원 테이블의 두 행을 결합(JOIN).
- where buy.mem_id = 'GRL'을 생략하여 모든 행을 살펴보자.
```text
mysql> select * from buy
    -> inner join member
    -> on buy.mem_id = member.mem_id;
+-----+--------+--------------+------------+-------+--------+--------+--------------+------------+--------+--------+----------+--------+------------+
| num | mem_id | prod_name    | group_name | price | amount | mem_id | mem_name     | mem_number | addr   | phone1 | phone2   | height | debut_date |
+-----+--------+--------------+------------+-------+--------+--------+--------------+------------+--------+--------+----------+--------+------------+
|   1 | BLK    | 지갑         | NULL       |    30 |      2 | BLK    | 블랙핑크     |          4 | 경남   | 055    | 22222222 |    163 | 2016-08-08 |
|   2 | BLK    | 맥북프로     | 디지털     |  1000 |      1 | BLK    | 블랙핑크     |          4 | 경남   | 055    | 22222222 |    163 | 2016-08-08 |
|   3 | APN    | 아이폰       | 디지털     |   200 |      1 | APN    | 에이핑크     |          6 | 경기   | 031    | 77777777 |    164 | 2011-02-10 |
|   4 | MMU    | 아이폰       | 디지털     |   200 |      5 | MMU    | 마마무       |          4 | 전남   | 061    | 99999999 |    165 | 2014-06-19 |
|   5 | BLK    | 청바지       | 패션       |    50 |      3 | BLK    | 블랙핑크     |          4 | 경남   | 055    | 22222222 |    163 | 2016-08-08 |
|   6 | MMU    | 에어팟       | 디지털     |    80 |     10 | MMU    | 마마무       |          4 | 전남   | 061    | 99999999 |    165 | 2014-06-19 |
|   7 | GRL    | 혼공SQL      | 서적       |    15 |      5 | GRL    | 소녀시대     |          8 | 서울   | 02     | 44444444 |    168 | 2007-08-02 |
|   8 | APN    | 혼공SQL      | 서적       |    15 |      2 | APN    | 에이핑크     |          6 | 경기   | 031    | 77777777 |    164 | 2011-02-10 |
|   9 | APN    | 청바지       | 패션       |    50 |      1 | APN    | 에이핑크     |          6 | 경기   | 031    | 77777777 |    164 | 2011-02-10 |
|  10 | MMU    | 지갑         | NULL       |    30 |      1 | MMU    | 마마무       |          4 | 전남   | 061    | 99999999 |    165 | 2014-06-19 |
|  11 | APN    | 혼공SQL      | 서적       |    15 |      1 | APN    | 에이핑크     |          6 | 경기   | 031    | 77777777 |    164 | 2011-02-10 |
|  12 | MMU    | 지갑         | NULL       |    30 |      4 | MMU    | 마마무       |          4 | 전남   | 061    | 99999999 |    165 | 2014-06-19 |
+-----+--------+--------------+------------+-------+--------+--------+--------------+------------+--------+--------+----------+--------+------------+
12 rows in set (0.00 sec)
```

### 내부 조인의 간결한 표현
- 열이 너무 많아 복잡해 보이므로, 이번에는 필요한 아이디/이름/구매 물품/주소/연락처만 추출해보자.
```text
mysql> select mem_id, mem_name, prod_name, addr, concat(phone1, phone2) '연락처' from buy
    -> inner join member
    -> on buy.mem_id = member.mem_id;
ERROR 1052 (23000): Column 'mem_id' in field list is ambiguous
```
- 오류가 발생함. 열 이름인 mem_id가 불확실하다는 오류 메시지. 즉, 회원 아이디(mem_id)는 회원 테이블, 구매 테이블에 모두 들어 있어서 어느 테이블의 mem_id 인지 헷갈린다는 의미.
- 이럴 때는 어느 테이블의 mem_id를 추출할지 정확하게 작성해야 함. 구매 테이블 기준으로 하고 있으므로 buy.mem_id가 논리적으로 맞는 것 같음.
```text
mysql> select buy.mem_id, mem_name, prod_name, addr, concat(phone1, phone2) '연락처' from buy inner join member on buy.mem_id = member.mem_id;
+--------+--------------+--------------+--------+-------------+
| mem_id | mem_name     | prod_name    | addr   | 연락처      |
+--------+--------------+--------------+--------+-------------+
| BLK    | 블랙핑크     | 지갑         | 경남   | 05522222222 |
| BLK    | 블랙핑크     | 맥북프로     | 경남   | 05522222222 |
| APN    | 에이핑크     | 아이폰       | 경기   | 03177777777 |
| MMU    | 마마무       | 아이폰       | 전남   | 06199999999 |
| BLK    | 블랙핑크     | 청바지       | 경남   | 05522222222 |
| MMU    | 마마무       | 에어팟       | 전남   | 06199999999 |
| GRL    | 소녀시대     | 혼공SQL      | 서울   | 0244444444  |
| APN    | 에이핑크     | 혼공SQL      | 경기   | 03177777777 |
| APN    | 에이핑크     | 청바지       | 경기   | 03177777777 |
| MMU    | 마마무       | 지갑         | 전남   | 06199999999 |
| APN    | 에이핑크     | 혼공SQL      | 경기   | 03177777777 |
| MMU    | 마마무       | 지갑         | 전남   | 06199999999 |
+--------+--------------+--------------+--------+-------------+
12 rows in set (0.00 sec)
```
- SQL을 좀 더 명확히 하기 위해 select 다음 열 이름(컬럼 이름)에도 모두 테이블_이름.열_이름 형식으로 작성해보자. 결과는 같음.
```sql
select buy.mem_id, member.mem_name, buy.prod_name, member.addr, concat(member.phone1, member.phone2) '연락처' 
from buy inner join member on buy.mem_id = member.mem_id;
```
- 각 열이 어느 테이블에 속한 것인지 명확해졌지만 코드가 너무 길어져서 오히려 복잡해 보인다. 이를 간결하게 표현하기 위해서는 테이블 이름 뒤에 별칭 사용.
```sql
select B.mem_id, M.mem_name, B.prod_name, M.addr, concat(M.phone1, M.phone2) '연락처'
from buy B
inner join member M
on B.mem_id = M.mem_id;
```

### 내부 조인의 활용
- 전체 회원의 아이디/이름/구매한 제품/주소를 출력하자. 지금 '전체 회원'이라고 하였음.
```text
mysql> select M.mem_id, M.mem_name, B.prod_name, M.addr
    -> from buy B
    -> inner join member M
    -> on B.mem_id = M.mem_id
    -> order by M.mem_id;
+--------+--------------+--------------+--------+
| mem_id | mem_name     | prod_name    | addr   |
+--------+--------------+--------------+--------+
| APN    | 에이핑크     | 아이폰       | 경기   |
| APN    | 에이핑크     | 혼공SQL      | 경기   |
| APN    | 에이핑크     | 청바지       | 경기   |
| APN    | 에이핑크     | 혼공SQL      | 경기   |
| BLK    | 블랙핑크     | 지갑         | 경남   |
| BLK    | 블랙핑크     | 맥북프로     | 경남   |
| BLK    | 블랙핑크     | 청바지       | 경남   |
| GRL    | 소녀시대     | 혼공SQL      | 서울   |
| MMU    | 마마무       | 아이폰       | 전남   |
| MMU    | 마마무       | 에어팟       | 전남   |
| MMU    | 마마무       | 지갑         | 전남   |
| MMU    | 마마무       | 지갑         | 전남   |
+--------+--------------+--------------+--------+
12 rows in set (0.00 sec)
```
- 구매 테이블의 목록이 12건이었으므로 이상 없이 잘 나왔지만, 전체 회원과는 차이가 있음.
- '전체 회원'이 아닌 '구매 내역이 있는 회원들'의 목록임.
- 즉, 결과에 한 번도 구매하지 않은 회원의 정보는 없음. 우리가 원하는 결과는 구매한 회원의 구매 기록과 더불어 구매하지 않은 회원의 이름/주소가 포함되는 것.
- 만약, 양쪽 중에 한곳이라도 내용이 있을 때 조인하려면 외부 조인을 사용해야 함.

### 중복된 결과 1개만 출력하기
```text
mysql> select distinct M.mem_id, M.mem_name, M.addr
    -> from buy B
    -> inner join member M
    -> on B.mem_id = M.mem_id
    -> order by M.mem_id;
+--------+--------------+--------+
| mem_id | mem_name     | addr   |
+--------+--------------+--------+
| APN    | 에이핑크     | 경기   |
| BLK    | 블랙핑크     | 경남   |
| GRL    | 소녀시대     | 서울   |
| MMU    | 마마무       | 전남   |
+--------+--------------+--------+
4 rows in set (0.01 sec)
```

## 외부 조인
- 내부 조인은 두 테이블에 모두 데이터가 있어야만 결과가 나옴. 이와 달리 외부 조인은 한쪽에만 데이터가 있어도 결과가 나옴.

### 외부 조인의 기본
- 외부 조인(outer join)은 두 테이블을 조인할 때 필요한 내용이 한쪽 테이블에만 있어도 결과 추출 가능.
- 외부 조인의 형식
```text
select <열 목록>
from <첫 번째 테이블(left 테이블)>
    <left | right | full> outer join <두 번째 테이블(right 테이블)>
    on <조인될 조건>
[where 검색 조건];
```
- 내부 조인보다는 조금 복잡하지만 사용 방법은 비슷.
- 먼저 내부 조인에서 해결하지 못한 '전체 회원의 구매 기록(구매 기록이 없는 회원의 정보도 함께) 출력'을 외부 조인으로 알아보자.
```text
mysql> select M.mem_id, M.mem_name, B.prod_name, M.addr
    -> from member M
    -> left outer join buy B
    -> on M.mem_id = B.mem_id
    -> order by M.mem_id;
+--------+--------------+--------------+--------+
| mem_id | mem_name     | prod_name    | addr   |
+--------+--------------+--------------+--------+
| APN    | 에이핑크     | 아이폰       | 경기   |
| APN    | 에이핑크     | 혼공SQL      | 경기   |
| APN    | 에이핑크     | 청바지       | 경기   |
| APN    | 에이핑크     | 혼공SQL      | 경기   |
| BLK    | 블랙핑크     | 지갑         | 경남   |
| BLK    | 블랙핑크     | 맥북프로     | 경남   |
| BLK    | 블랙핑크     | 청바지       | 경남   |
| GRL    | 소녀시대     | 혼공SQL      | 서울   |
| ITZ    | 잇지         | NULL         | 경남   |
| MMU    | 마마무       | 아이폰       | 전남   |
| MMU    | 마마무       | 에어팟       | 전남   |
| MMU    | 마마무       | 지갑         | 전남   |
| MMU    | 마마무       | 지갑         | 전남   |
| OMY    | 오마이걸     | NULL         | 서울   |
| RED    | 레드벨벳     | NULL         | 경북   |
| SPC    | 우주소녀     | NULL         | 서울   |
| TWC    | 트와이스     | NULL         | 서울   |
| WMN    | 여자친구     | NULL         | 경기   |
+--------+--------------+--------------+--------+
18 rows in set (0.00 sec)
```
- left outer join의 의미를 '왼쪽 테이블(member)의 내용은 모두 출력되어야 한다'로 해석하면 기억하기 쉬움.
- right outer join으로 동일한 결과를 출력하려면 다음과 같이 단순히 왼쪽과 오른쪽 테이블의 위치만 바꿔주면 됨.
```text
mysql> select M.mem_id, M.mem_name, B.prod_name, M.addr
    -> from buy B
    -> right outer join member M
    -> on M.mem_id = B.mem_id
    -> order by M.mem_id;
+--------+--------------+--------------+--------+
| mem_id | mem_name     | prod_name    | addr   |
+--------+--------------+--------------+--------+
| APN    | 에이핑크     | 아이폰       | 경기   |
| APN    | 에이핑크     | 혼공SQL      | 경기   |
| APN    | 에이핑크     | 청바지       | 경기   |
| APN    | 에이핑크     | 혼공SQL      | 경기   |
| BLK    | 블랙핑크     | 지갑         | 경남   |
| BLK    | 블랙핑크     | 맥북프로     | 경남   |
| BLK    | 블랙핑크     | 청바지       | 경남   |
| GRL    | 소녀시대     | 혼공SQL      | 서울   |
| ITZ    | 잇지         | NULL         | 경남   |
| MMU    | 마마무       | 아이폰       | 전남   |
| MMU    | 마마무       | 에어팟       | 전남   |
| MMU    | 마마무       | 지갑         | 전남   |
| MMU    | 마마무       | 지갑         | 전남   |
| OMY    | 오마이걸     | NULL         | 서울   |
| RED    | 레드벨벳     | NULL         | 경북   |
| SPC    | 우주소녀     | NULL         | 서울   |
| TWC    | 트와이스     | NULL         | 서울   |
| WMN    | 여자친구     | NULL         | 경기   |
+--------+--------------+--------------+--------+
18 rows in set (0.01 sec)
```

### 외부 조인의 활용
- 내부 조인으로 구매한 기록이 있는 회원들의 목록만 추출해서 감사문을 보냈었음. 이번에는 반대로 회원으로 가입만 하고, 한 번도 구매한 적이 없는 회원의 목록을 추출해보자.
```text
mysql> select distinct M.mem_id, B.prod_name, M.mem_name, M.addr
    -> from Member M
    -> left outer join buy B
    -> on M.mem_id = B.mem_id
    -> where B.prod_name is null
    -> order by M.mem_id;
+--------+-----------+--------------+--------+
| mem_id | prod_name | mem_name     | addr   |
+--------+-----------+--------------+--------+
| ITZ    | NULL      | 잇지         | 경남   |
| OMY    | NULL      | 오마이걸     | 서울   |
| RED    | NULL      | 레드벨벳     | 경북   |
| SPC    | NULL      | 우주소녀     | 서울   |
| TWC    | NULL      | 트와이스     | 서울   |
| WMN    | NULL      | 여자친구     | 경기   |
+--------+-----------+--------------+--------+
6 rows in set (0.00 sec)
```
- FULL OUTER JOIN은 왼쪽 외부 조인과 오른쪽 외부 조인이 합쳐진 것. 왼쪽이든 오른쪽이든 한쪽에 들어 있는 내용이면 출력함. 자주 사용 X.

## 기타 조인
- 내부 조인이나 외부 조인처럼 자주 사용되지는 않지만 가끔 유용하게 사용되는 조인으로 상호 조인과 자체 조인도 존재.

### 상호 조인 (cross join)
- 상호 조인은 한쪽 테이블의 모든 행과 다른 쪽 테이블의 모든 행을 조인시키는 기능을 말함.
- 그래서 상호 조인 결과의 전체 행 개수는 두 테이블의 각 행의 개수를 곱한 개수가 됨.
```text
mysql> select * from buy
    -> cross join member;
+-----+--------+--------------+------------+-------+--------+--------+--------------+------------+--------+--------+----------+--------+------------+
| num | mem_id | prod_name    | group_name | price | amount | mem_id | mem_name     | mem_number | addr   | phone1 | phone2   | height | debut_date |
+-----+--------+--------------+------------+-------+--------+--------+--------------+------------+--------+--------+----------+--------+------------+
|   1 | BLK    | 지갑         | NULL       |    30 |      2 | WMN    | 여자친구     |          6 | 경기   | 031    | 33333333 |    166 | 2015-01-15 |
|   1 | BLK    | 지갑         | NULL       |    30 |      2 | TWC    | 트와이스     |          9 | 서울   | 02     | 11111111 |    167 | 2015-10-19 |
|   1 | BLK    | 지갑         | NULL       |    30 |      2 | SPC    | 우주소녀     |         13 | 서울   | 02     | 88888888 |    162 | 2016-02-25 |
|   1 | BLK    | 지갑         | NULL       |    30 |      2 | RED    | 레드벨벳     |          4 | 경북   | 054    | 55555555 |    161 | 2014-08-01 |
|   1 | BLK    | 지갑         | NULL       |    30 |      2 | OMY    | 오마이걸     |          7 | 서울   | NULL   | NULL     |    160 | 2015-04-21 |
|   1 | BLK    | 지갑         | NULL       |    30 |      2 | MMU    | 마마무       |          4 | 전남   | 061    | 99999999 |    165 | 2014-06-19 |
|   1 | BLK    | 지갑         | NULL       |    30 |      2 | ITZ    | 잇지         |          5 | 경남   | NULL   | NULL     |    167 | 2019-02-12 |
|   1 | BLK    | 지갑         | NULL       |    30 |      2 | GRL    | 소녀시대     |          8 | 서울   | 02     | 44444444 |    168 | 2007-08-02 |
|   1 | BLK    | 지갑         | NULL       |    30 |      2 | BLK    | 블랙핑크     |          4 | 경남   | 055    | 22222222 |    163 | 2016-08-08 |
|   1 | BLK    | 지갑         | NULL       |    30 |      2 | APN    | 에이핑크     |          6 | 경기   | 031    | 77777777 |    164 | 2011-02-10 |
|   2 | BLK    | 맥북프로     | 디지털     |  1000 |      1 | WMN    | 여자친구     |          6 | 경기   | 031    | 33333333 |    166 | 2015-01-15 |
|   2 | BLK    | 맥북프로     | 디지털     |  1000 |      1 | TWC    | 트와이스     |          9 | 서울   | 02     | 11111111 |    167 | 2015-10-19 |
|   2 | BLK    | 맥북프로     | 디지털     |  1000 |      1 | SPC    | 우주소녀     |         13 | 서울   | 02     | 88888888 |    162 | 2016-02-25 |
...
|  11 | APN    | 혼공SQL      | 서적       |    15 |      1 | TWC    | 트와이스     |          9 | 서울   | 02     | 11111111 |    167 | 2015-10-19 |
|  11 | APN    | 혼공SQL      | 서적       |    15 |      1 | SPC    | 우주소녀     |         13 | 서울   | 02     | 88888888 |    162 | 2016-02-25 |
|  11 | APN    | 혼공SQL      | 서적       |    15 |      1 | RED    | 레드벨벳     |          4 | 경북   | 054    | 55555555 |    161 | 2014-08-01 |
|  11 | APN    | 혼공SQL      | 서적       |    15 |      1 | OMY    | 오마이걸     |          7 | 서울   | NULL   | NULL     |    160 | 2015-04-21 |
|  11 | APN    | 혼공SQL      | 서적       |    15 |      1 | MMU    | 마마무       |          4 | 전남   | 061    | 99999999 |    165 | 2014-06-19 |
|  11 | APN    | 혼공SQL      | 서적       |    15 |      1 | ITZ    | 잇지         |          5 | 경남   | NULL   | NULL     |    167 | 2019-02-12 |
|  11 | APN    | 혼공SQL      | 서적       |    15 |      1 | GRL    | 소녀시대     |          8 | 서울   | 02     | 44444444 |    168 | 2007-08-02 |
|  11 | APN    | 혼공SQL      | 서적       |    15 |      1 | BLK    | 블랙핑크     |          4 | 경남   | 055    | 22222222 |    163 | 2016-08-08 |
|  11 | APN    | 혼공SQL      | 서적       |    15 |      1 | APN    | 에이핑크     |          6 | 경기   | 031    | 77777777 |    164 | 2011-02-10 |
|  12 | MMU    | 지갑         | NULL       |    30 |      4 | WMN    | 여자친구     |          6 | 경기   | 031    | 33333333 |    166 | 2015-01-15 |
|  12 | MMU    | 지갑         | NULL       |    30 |      4 | TWC    | 트와이스     |          9 | 서울   | 02     | 11111111 |    167 | 2015-10-19 |
|  12 | MMU    | 지갑         | NULL       |    30 |      4 | SPC    | 우주소녀     |         13 | 서울   | 02     | 88888888 |    162 | 2016-02-25 |
|  12 | MMU    | 지갑         | NULL       |    30 |      4 | RED    | 레드벨벳     |          4 | 경북   | 054    | 55555555 |    161 | 2014-08-01 |
|  12 | MMU    | 지갑         | NULL       |    30 |      4 | OMY    | 오마이걸     |          7 | 서울   | NULL   | NULL     |    160 | 2015-04-21 |
|  12 | MMU    | 지갑         | NULL       |    30 |      4 | MMU    | 마마무       |          4 | 전남   | 061    | 99999999 |    165 | 2014-06-19 |
|  12 | MMU    | 지갑         | NULL       |    30 |      4 | ITZ    | 잇지         |          5 | 경남   | NULL   | NULL     |    167 | 2019-02-12 |
|  12 | MMU    | 지갑         | NULL       |    30 |      4 | GRL    | 소녀시대     |          8 | 서울   | 02     | 44444444 |    168 | 2007-08-02 |
|  12 | MMU    | 지갑         | NULL       |    30 |      4 | BLK    | 블랙핑크     |          4 | 경남   | 055    | 22222222 |    163 | 2016-08-08 |
|  12 | MMU    | 지갑         | NULL       |    30 |      4 | APN    | 에이핑크     |          6 | 경기   | 031    | 77777777 |    164 | 2011-02-10 |
+-----+--------+--------------+------------+-------+--------+--------+--------------+------------+--------+--------+----------+--------+------------+
120 rows in set (0.00 sec)
```
- 회원 테이블 10개 행과 구매 테이블의 12개 행 총 120개의 결과가 생성됨.
- 상호 조인의 특징은 다음과 같음.
1. ON 구문 사용 불가.
2. 결과의 내용은 의미가 없음. 랜덤으로 조인하기 때문.
3. 상호 조인의 주 용도는 테스트하기 위해 대용량의 데이터를 생성할 때.

### 자체 조인
- 내부 조인, 외부 조인, 상호 조인은 모두 2개의 테이블을 조인. 자체 조인(self join)은 자신이 자신과 조인한다는 의미.
- 그래서 자체 조인은 1개의 테이블 사용. 또, 별도의 문법이 있는 것이 아닌 1개로 조인하면 자체 조인이 됨.
- 실무에서 자체 조인을 많이 사용하지는 않지만, 대표적인 사례로 회사의 조직 관계를 살펴볼 수 있음.
- 각 직원들이 직속 상관들을 가지고 있고, 직속 상관의 사내 연락처를 알고 싶다면 자체 조인을 통해 알아내야 함.
```sql
CREATE TABLE emp_table (emp CHAR(4), manager CHAR(4), phone VARCHAR(8));

INSERT INTO emp_table VALUES('대표', NULL, '0000');
INSERT INTO emp_table VALUES('영업이사', '대표', '1111');
INSERT INTO emp_table VALUES('관리이사', '대표', '2222');
INSERT INTO emp_table VALUES('정보이사', '대표', '3333');
INSERT INTO emp_table VALUES('영업과장', '영업이사', '1111-1');
INSERT INTO emp_table VALUES('경리부장', '관리이사', '2222-1');
INSERT INTO emp_table VALUES('인사부장', '관리이사', '2222-2');
INSERT INTO emp_table VALUES('개발팀장', '정보이사', '3333-1');
INSERT INTO emp_table VALUES('개발주임', '정보이사', '3333-1-1');
```
- 자체 조인의 형식은 다음과 같음. 테이블이 1개지만 다른 별칭을 사용해서 서로 다른 것처럼 사용하면 됨.
```sql
select <열 목록>
from <테이블> 별칭A
    inner join <테이블> 별칭B
    on <조인될 조건>
[where 검색 조건]
```
- 자체 조인을 활용해 경리부장 직속 상관의 연락처를 알아보자.
```text
mysql> select A.emp "직원", B.emp "직속상관", B.phone "직속상관연락처"
    -> from emp_table A
    -> inner join emp_table B
    -> on A.manager = B.emp
    -> where A.emp = '경리부장';
+--------------+--------------+-----------------------+
| 직원         | 직속상관     | 직속상관연락처        |
+--------------+--------------+-----------------------+
| 경리부장     | 관리이사     | 2222                  |
+--------------+--------------+-----------------------+
1 row in set (0.00 sec)
```

## 정리
- 일대다 관계란 한쪽 테이블에는 하나의 값만, 다른 쪽 테이블에는 여러 개의 값이 존재할 수 있는 관계.
- 조인은 두 개의 테이블을 서로 묶어서 하나의 결과를 만들어 내는 것.
- 내부 조인은 두 테이블을 조인할 때, 두 테이블에 모두 지정한 열의 데이터가 있어야 함.
- 외부 조인은 두 테이블을 조인할 때, 1개의 테이블에만 데이터가 있어도 결과가 나옴.
- 상호 조인은 한쪽 테이블의 모든 행과 다른 쪽 테이블의 모든 행을 조인시키는 기능.
- 자체 조인은 자신이 자신과 조인된다는 의미로, 1개의 테이블을 사용.

## 용어 정리
- 관계 : 두 테이블이 서로 연관되는 것
- 기본 키-외래 키 관계 : 두 테이블이 일대다 관계로 연결되기 위한 조건
- 별칭(alias) : 조인에서 테이블의 이름을 짧게 표현하는 이름
- DINTINCT 문 : 중복된 열의 값을 1개만 표현하는 구문
- LEFT OUTER JOIN : 왼쪽 테이블의 모든 값이 출력되는 조인
- RIGHT OUTER JOIN : 오른쪽 테이블의 모든 값이 출력되는 조인
- FULL OUTER JOIN : 왼쪽 또는 오른쪽 테이블의 모든 값이 출력되는 조인
- CREATE TABLE ~ SELECT : SELECT의 결과가 테이블로 생성되는 구문


