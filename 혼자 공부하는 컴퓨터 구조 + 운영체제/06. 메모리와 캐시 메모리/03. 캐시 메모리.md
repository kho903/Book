# 캐시 메모리
- CPU는 프로그램 실행 과정에서 저장된 데이터를 빈번하게 사용하는데 메모리 접근 시간은 CPU 연산 속도보다 느려, 빠른 연산 속도의 효율성이 나빠진다.
이를 극복하기 위한 저장 장치가 캐시 메모리.
- 캐시 메모리의 탄생 배경과 특징 이해를 위해 저장 장치 계층 구조라는 개념을 이해해야 한다.

## 저장 장치 계층 구조
- 저장 장치는 아래와 같은 명제로, '빠른 저장 장치'와 '용량이 큰 저장 장치' 양립이 어렵다.
1. CPU와 가까운 저장 장치는 빠르고, 멀리 있는 저장 장치는 느리다.
2. 속도가 빠른 저장 장치는 저장 용량이 작고, 가격이 비싸다.
- CPU와 가까운 레지스터는 일반적으로 RAM보다 용량은 작고, 접근 시간이 압도적으로 빠르고 가격이 비싸다. USB 메모리 보다 CPU에 가까운 RAM은 접근 시간이 
훨씬 더 빠르지만 용량 대비 가격이 더 비싸다.
- 즉, 낮은 가격대의 대용량 저장 장치를 원한다면 느린 속도는 감수해야 하고, 빠른 메모리를 원한다면 작은 용량과 비싼 가격을 감수해야 한다.
일반적으로 컴퓨터는 다양한 저장 장치를 모두 사용.
- 컴퓨터가 사용하는 저장 장치들은 'CPU에 얼마나 가까운가'를 기준으로 계층적으로 나타낼 수 있다.
- CPU와 가까운 순으로 레지스터-메모리-보조기억장치 이며, CPU와 가까울 수록 속도는 빠르고, 용량은 작고, 가격이 비싸다.

## 캐시 메모리
- CPU가 메모리에 접근하는 속도는 레지스터에 접근하는 속도보다 느림에도 프로그램 실행 과정에서 빈번히 접근해야 한다. CPU 연산 속도에 미치지 못한다면 CPU
발전은 소용이 없어진다.
- 그래서 등장한 저장 장치가 캐시 메모리로, CPU와 메모리 사이에 위치하고, 레지스터보다 용량이 크고 메모리보다 빠른 SRAM 기반의 저장 장치. CPU의 연산 속도와
메모리 접근 속도의 차이를 조금이나마 줄이기 위해 탄생했고, 메모리에서 CPU가 사용할 일부 데이터를 미리 가지고 와서 활용하자는 취지.
- 캐시 메모리까지 반영한 저장 장치 계층 구조는 레지스터-캐시 메모리-메모리-보조기억장치 이다.
- 컴퓨터 내부에는 여러 개의 캐시 메모리가 있는데, 이 캐시 메모리들은 CPU(코어)와 가까운 순서대로 계층을 구헝한다. 가까운 캐시 메모리부터 L1, L2, L3 캐시라고 부른다.
- 캐시 메모리 용량은 L1, L2, L3 순으로 커지고 속도는 L3, L2, L1 순으로 빨라진다. 가격 또한 L3, L2, L1 순으로 비싸다.
- 멀티 코어 프로세스에서는 L1 캐시와 L2 캐시는 코어마다 고유한 캐시 메모리로 할당되고, L3 캐시는 여러 코어가 공유하는 형태로 사용된다.
  - 코어와 가장 가까운 L1 캐시는 조금이라도 속도를 빠르게 하기 위해 명령어만을 저장하는 L1I 캐시와 데이터만을 저장하는 L1D 캐시로 분리하는 경우도 있는데,
    이를 분리형 캐시(split cache)라고 한다.
- 캐시 메모리 계층 구조에 따라 저장 장치 계층 구조는 레지스터-L1캐시-L2캐시-L3캐시-주기억장치-보조기억장치로 그릴 수 있다. 중요한 것은 상위 계층을 이루고
있는 저장 장치의 특징과 하위 계층을 이루고 있는 저장 장치의 특징을 이해하고 그 차이를 이해하는 것.

## 참조 지역서 원리
- 캐시 메모리는 메모리보다 용량이 작아 당연히 메모리의 모든 내용을 저장은 불가.
- 보조기억장치는 전원이 꺼져도 기억할 대상을 저장하고, 메모리는 실행 중인 대상을 저장한다면 캐시 메모리는 CPU가 사용할 법한 대상을 예측하여 저장.
- 이때 자주 사용될 것으로 예측한 데이터가 실제로 들어맞아 캐시 메모리 내 데이터가 CPU에서 활용될 경우를 캐시 히트(cache hit)라고 한다.
- 반대로 자주 사용될 것으로 예측해 저장했지만 예측이 틀려 메모리에서 데이터를 가져와야 하는 경우를 캐시 미스(cache miss)라고 한다. 당연히 캐시 미스가 자주
발생하면 성능이 떨어지게 된다.
- 캐시가 히트되는 비율을 캐시 적중률(cache hit ratio)라고 하고, 다음과 같다. (캐시 히트 횟수 / (캐시 히트 횟수 + 캐시 미스 횟수))
- 우리가 사용하는 컴퓨터의 캐시 적중률은 대략 85~95% 이상.
- 캐시 메모리의 이점을 제대로 활용하려면 캐시 적중률을 높여야 한다. 어떻게 CPU가 사용할 법한 데이터를 알 수 있을까?
- 참조 지역성의 원리(locality of reference, principle of locality)에 따라 가져올 데이터를 결정. 다음과 같은 CPU가 메모리에 접근할 떄의 경향으로 만들어졌다.
1. CPU는 최근에 접근했던 메모리 공간에 다시 접근하려는 경향이 있다.
2. CPU는 접근한 메모리 공간 근처를 접근하려는 경향이 있다.

### 첫째, '최근에 접근했던 메모리 공간에 다시 접근하려는 경향'
- 프로그래밍에서 '변수'에 값을 저장하고 나면 언제든 변수에 저장된 값 사용 가능. 이는 즉, 'CPU는 변수가 저장된 메모리 공간을 언제든 다시 참조할 수 있다'를 의미.
- 변수에 저장된 값은 일반적으로 한 번만 사용되지 않고 프로그램이 실행되는 동안 여러 번 사용되므로 CPU는 최근에 접근했던 (변수가 저장된) 메모리 공간을 여러 번
다시 접근할 수 있다,.
- 이렇게 '최근에 접근했던 메모리 공간에 다시 접근하려는 경향'을 시간 지역성(temporal locality)이라고 한다.

### 둘째, '접근한 메모리 공간 근처를 접근하려는 경향'
- CPU가 실행하려는 프로그램은 보통 관련 데이터들끼리 한데 모여 있다. 각 프로그램 별로 괸련 데이터들이 모여 저장된다.
- 그리고, 하나의 프로그램 내에서도 관련 있는 데이터들은 모여서 저장된다. 가령, 워드 프로세서 프로그램에 자동 저장 기능, 입력 기능, 출력 기능이 있다고 했을 때,
각각의 기능과 관련한 데이터는 모여 저장된다.
- CPU가 워드 프로세서 프로그램을 실행할 적에는 워드 프로세서 프로그램이 모여 있는 공간 근처를 집중적으로 접근할 것이고, 사용자가 입력을 할 적에는 입력 기능이 모여
있ㄷ는 공간 근처를 집중적으로 접근할 것이다.
- 이렇게 '접근한 메모리 공간 근처를 접근하려는 경향'을 공간 지역성 (spatial locality)라고 한다.


- 캐시 메모리는 이렇듯 참조 지역성의 원리에 입각해 CPU가 사용할 법한 데이터를 예측한다.

## 키워드 정리
- 저장 장치 계층 구조는 각기 다른 용량과 성능의 저장 장치들을 계층화하여 표현한 구조
- 캐시 메모리는 CPU의 연산 속도와 메모리 접근 속도의 차이를 줄이기 위한 저장 장치
- 캐시 적중률이 높으면 CPU의 메모리 접근 횟수를 줄일 수 있다.
- 캐시 메모리는 참조 지역성의 원리에 따라 데이터를 예측하여 캐시 적중률을 높인다.

