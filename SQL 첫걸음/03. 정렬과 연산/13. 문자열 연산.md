# 13. 문자열 연산
- 데이터에는 수치형 외에 문자열형도 있다. 문자열 연산에 대해 알아보자.
- 문자열 연산
```text
+ || CONCAT SUBSTRING TRIM CHARACTER_LENGTH
```
- 문자열끼리 연산하는 연산자는 많지 않다. 이 절에서는 문자열 결합에 관해서만 다룬다. 이와 관련해 문자열을 가공하는 함수 중 자주 사용하는 것을 알아보자.

## 1. 문자열 결합
- 문자열 결합이란 다음과 같이 문자열 데이터를 결합하는 연산
```text
'ABC' || `1234` -> 'ABC1234'
```
- 문자열을 결합하는 연산자에는 DB 제품마다 방언이 있으며 다음과 같은 차이를 가진다.

| 연산자/함수       | 연산     | 데이터베이스                  |
|--------------|--------|-------------------------|
| +            | 문자열 결합 | SQL Server              |
| &#124;&#124; | 문자열 결합 | Oracle, DB2, PostgreSQL |
| +            | 문자열 결합 | MySQL                   |

- SQL Server는 문자열 결합에 + 연산자를 사용. Oracle이나 DB2, PostgreSQL에서는 || 연산자를 사용해서 문자열을 결합. 
MySQL에서는 CONCAT 함수로 문자열을 결합.
> `+` 연산자, || 연산자, CONCAT 함수로 문자열을 결합할 수 있다.
- 문자열 결합은 '2개의 열 데이터를 모아서 1개의 열로 처리하고 싶은' 경우에 자주 사용. 
- 문자열 결합으로 단위를 연결해 결과 얻기
```text
mysql> select concat(quantity, unit) from sample35;
+------------------------+
| concat(quantity, unit) |
+------------------------+
| 10개                   |
| 24통                   |
| 1장                    |
+------------------------+
3 rows in set (0.00 sec)
```
- unit 열은 문자열형이고 quantity 열은 INTEGER 형의 열이다. CONCAT 함수를 이용해 두 열을 결합했다.
- 문자열 결합이지만 수치 데이터도 문제 없이 연산 가능. 단, 문자열로 결합한 결과는 문자열형이 된다.
- 한편, Oracle 에서는 quantity || unit, SQL Server 에서는 quantity + unit 으로 결합.

## 2. SUBSTRING 함수
- SUBSTRING 함수는 문자열의 일부분을 계산해서 반환해주는 함수. 데이터베이스에 따라서는 함수명이 SUBSTR 인 경우도 있다.
- 블로그 시스템 등에서는 사용자가 업로드한 데이터를 특정지을 수 있도록 날짜와 연속된 번호를 사용해 유일한 ID를 지정하는 경우가 많다. 이러한 ID를 하나의 열에
저장하는 경우도 있지만 보통 다루기 쉽도록 날짜와 연속된 번호라는 두 개의 열로 나누는 경우가 많다.
- 또한 연월일을 YYYYMMDD와 같은 형식의 문자열 데이터로 저장하는 경우도 아주 많다. 해당 날짜 데이터에서 년, 월, 일을 각각 따로 추출해내고 싶은 경우가
있을 것이다. 이런 경우 SUBSTRING 함수를 사용해 간편하게 문자열을 추출해낼 수 있다.
```text
앞 4자리(년) 추출
SUBSTRING('20230217', 1, 4) -> '2023'

5째 자리부터 2자리(월) 추출
SUBSTRING('20230217', 5, 2) -> '01'
```

## 3. TRIM 함수
- TRIM 함수는 문자열의 앞뒤로 여분의 스페이스가 있을 경우 이를 제거해주는 함수로 문자열 도중에 존재하는 스페이스는 제거되지 않는다. 고정길이 문자열형에 대해
많이 사용하는 함수.
- CHAR 형의 문자열형에서는 문자열의 길이가 고정되며 남은 공간은 스페이스로 채워진다. 이처럼 빈 공간을 채우기 위해 사용한 스페이스를 제거하는 데 TRIM 함수를
사용할 수 있다. 한편, 인수를 지정하는 것으로 스페이스 이외의 문자를 제거할 수도 있다.
```text
TRIM('ABC   ') -> 'ABC'
```

## 4. CHARACTER_LENGTH 함수
- CHARACTER_LENGTH 함수는 문자열의 길이를 계산해 돌려주는 함수. VARCHAR 형의 문자열은 가변 길이이므로 길이가 서로 다르다.
- CHARACTER_LENGTH 함수를 사용하면 문자열의 길이를 계산 가능. 문자열의 길이는 문자 단위로 계산되어 수치로 반환됨. 또한 함수명은 CHAR_LENGTH로 줄여서
사용 가능. 한편 OCTET_LENGTH 함수는 문자열의 길이를 바이트 단위로 계산해 돌려주는 함수
- 조금 까다로운 내용으로 컴퓨터 안에는 이미지 데이터, 음성 데이터, 수치 데이터, 문자열 데이터 등 다양한 종류의 데이터가 저장된다. 하지만 이런 데이터는 '전부
수치'라고 자주 언급된다. 다시 말해 문자열 데이터도 결국 수치로 저장된다는 것이다.
- 데이터 단위로 '바이트'라는 것이 있다. SQL의 OCTET_LENGTH 함수를 잘 사용하는 동시에 중요한 것은 문자 하나의 데이터가 몇 바이트의 저장공간을 필요로
하는지 '인코드 방식'에 따라 결정된다는 점. 바꿔 말하자면 문자를 수치화(인코드) 하는 방식에 따라 필요한 저장공간의 크기가 달라진다는 것. VARCHAR 형의 최대
길이 역시 바이트 단위로 지정. 하지만 문자 세트(character set)dㅔ 따라 길이가 문자 수로 간주되기도 하니 주의할 필요가 있다.

### 문자 세트 (character set)
- 한중일의 인쇄 문화에서는 반각과 전각이라는 용어를 사용해 문자의 폭을 설명하기도 한다. 예를 들어 알파벳의 경우는 반각문자, 한글은 전각문자라고 할 수 있다.
반각과 전각의 차이는 화면상의 표시를 보면 잘 알 수 있다. 반각 문자는 전각 문자 폭의 절반밖에 안 되며 저장용량 또한 전각 문자 쪽이 더 크다. 반각의 앞파벳이나
숫자, 기호는 'ASCII 문자'라고 불린다.
- 한글의 경우 'EUC-KR', 'UTF-8' 등의 인코딩 방식을 주로 사용. 인코딩 방식은 데이터베이스나 테이블을 정의할 때 변경 가능. 이를 RDBMS에서는 '문자세트'
라고 부른다.
- 핵심은 '한 문자가 몇 바이트인지는 쓰이는 문자세트에 따라 다르다'는 것.
- CHAR_LENGTH 함수를 사용하는 경우에는 아무런 문제가 되지 않는다. 한글이든 ASCII 문자든 문자 수로 계산되기 때문이다. 하지만 OCTET_LENGTH 함수의
경우는 문자 수가 아닌 바이트 단위로 길이를 계산하므로 주의 필요.
- 'A는 반각, 한은 전각'이라는 문자열의 문자 수와 바이트 수를 문자세트 별로 조사하면 다음과 같다.
- 문자 세트 별 문자 수와 바이트 수

| 문자세트   | 문자 수 | 바이트 수 |
|--------|------|-------|
| EUC-KR | 12   | 19    |
| UTF-8  | 12   | 26    |

- EUC-KR 에서 ASCII 문자는 1바이트, 한글은 2바이트의 용량을 가진다. 한편 UTF-8에서 ASCII 문자는 1바이트, 한글은 3바이트의 용량을 가진다.
- 이렇게 문자세트에 따라 한 문자의 크기는 달라진다. 문자열 조작 함수로 문자 단위가 아닌 바이트 단위로 지정할 경우에는 문자세트에 주의할 필요가 있다.
> 문자열 데이터의 길이는 문자세트에 따라 다르다!
