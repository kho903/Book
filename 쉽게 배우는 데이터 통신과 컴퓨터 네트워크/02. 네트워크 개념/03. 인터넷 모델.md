# 03. 인터넷 모델
- 인터넷은 데이터의 중개 기능을 담당하는 네트워크 계층으로 IP(Internet Protocol) 프로토콜을 사용하는 네트워크.
- 따라서 인터넷에 연결하고자 하는 호스트는 반드시 IP 프로토콜을 지원해야 하며, 전송 계층은 TCP(Transmission Control Protocol)나 UDP(User Datagram Protocol)를 사용함.
- 현재 인터넷에서 주로 사용하는 IP 프로토콜은 버전 4(IPv4).

## 1. 구현 환경
- 인터넷에 연결된 호스트들의 네트워크 구현 모델에서는 전송 계층까지의 기능을 시스템 공간인 운영체제 내부에 구현함. 즉, 인터넷 환경에서 사용하는 TCP/IP와 하위 계층의 기능을 담당하는 LAN 카드
드라이버 루틴(Driver Routine)은 운영체제 영역에 속함.
- TCP/IP를 이용하려면 소켓 기능이 필요하며, 사용자 공간에서 네트워크 응용 기능을 지원하는 프로그램을 작성해야 함. 예를 들어, 스마트폰에서 실행되는 네트워크 관련 앱들이 네트워크 프로세스에 해당.

### 시스템 공간
- TCP와 UDP 프로토콜은 시스템 운영체제인 커널(Kernel) 내부에 구현되므로 일반 사용자가 이 기능을 직접 이용할 수는 없음. 대신 소켓(Socket) 인터페이스라는 전송 계층의 프리미티브를 이용해야
하는데, 소켓은 운영체제에서 시스템 콜 기능으로 구현되므로 사용자 프로그램에서 이를 함수 호출 방식으로 사용함. TCP는 연결형 서비스, UDP는 비연결형 서비스를 제공함.
- 인터넷에서 네트워크 계층은 IP(Internet Protol)로 구현되며 전송 패킷의 올바른 경로 선택 기능 제공. 네트워크 프로세스를 실행하는 호스트 사이에는 다수의 라우터가 존재하며, 이 라우터들은
IP 프로토콜을 이용해 패킷 중개 기능을 수행.
- 인터넷은 라우터들의 집합이며, 스마트폰을 포함한 일반 호스트들은 인터넷 끝단에 연결되는 종단 장치에 해당. 네트워크 계층 아래의 계층들은 LAN 카드와 LAN 카드를 구동하는 드라이버 루틴에 의해 구현.

### 사용자 공간
- 세션 계층부터 응용 계층까지의 기능은 사용자 응용 프로그램으로 구현됨. 프로그래밍 환경에서 전송 계층의 기능을 제공하는 소켓 시스템 콜을 호출해 TCP와 UDP 기능을 사용 가능.
- 소켓 시스템은 유닉스(Unix), 리눅스(Linux), 윈도우즈 운영체제 등 인터넷에 접속 가능한 모든 호스트에서 제공함.
- 프로그램에서 소켓을 사용할 때는 소켓마다 부여되는 고유 주소인 포트 번호를 관리해야 함. IP 주소는 호스트를 구분하는 주소 역할을 하지만, 포트 번호는 특정 호스트에서 실행되는 네트워크 프로세스를
구분하는 주소. 일반 네트워크 프로세스는 포트 하나를 할당해 사용하므로 포트 번호와 네트워크 프로세스가 일대일로 대응됨. 응용 환경에 따라 포트 번호를 여러 개 할당할 수도 있음. 응용 네트워크
프로그램을 설계할 때는 포트 할당에 주의해야 하지만, 일반 사용자는 프로그램 하나에 포트 하나를 사용한다고 가정해도 큰 문제 없음. 인터넷 응용 프로세스의 고유 주소는 IP 주소와 포트 번호의 조합으로
완성.
- 상위 계층은 사용자 프로그램 공간에 구현됨. 네트워크 응용 프로그램으로는 전통적인 텔넷(Telnet), FTP, 웹 브라우저 등을 포함해 스마트폰과 일반 PC에서 실행되는 수많은 앱이 있는데, 모두
TCP와 UDP를 사용해 네트워크에 연결.

## 2. 프로토콜
- 인터넷에서 데이터 전송은 계층 4의 TCP와 UDP 프로토콜, 계층 3의 IP 프로토콜에 의해 이루어짐. 인터넷 모델에서는 사용자 데이터의 전송이 TCP, UDP, IP 프로토콜에 의해 이루어지지만, 이들이
올바르게 작동하려면 더 많은 제어용 프로토콜이 필요. 특히, 주소 문제를 해결하기 위한 ARP/RARP 프로토콜과 오류 문제 해결 위한 ICMP 프로토콜은 인터넷 모델 동작에 매우 중요한 역할을 함.

### 프로토콜 계층 구조
- 맨 위의 응용 프로세스는 TCP, UDP를 사용해 데이터 송수신 기능을 수행하지만, 특별한 환경에서 네트워크 계층의 IP 프로토콜을 직접 사용하기도 함. ICMP와 ARP/RARP는 사용자 데이터를 전송하지
않기 때문에 특정 계층으로 설명하기 애매하지만, 일반적으로 네트워크 계층으로 분류.
- ICMP와 ARP/RARP가 전송하는 제어용 데이터들은 같은 계층에 속하는 IP 프로토콜의 도움을 받는다는 점이 특별함. 인터넷의 제어용 프로토콜은 그 종류가 매우 다양하다.
- 네트워크 계층의 IP는 사용자 데이터를 전송하는 프로토콜. IP의 동작 과정에서 전송 오류가 발생하는 경우에 대비해 오류 정보를 제어하는 목적으로 ICMP(Internet Control Message Protocol)
을 사용함. ICMP는 IP 프로토콜과 같은 계층으로 간주할 수 있지만, ICMP에서 발생하는 ICMP 메시지는 IP 패킷에 캡슐화되어 전송됨.

### ARP (Address Resolution Protocol) 와 RARP (Reverse Address Resolution Protocol)
- 인터넷 모델에서 사용하는 주소는 데이터 링크 계층의 MAC 주소, 네트워크 계층의 IP 주소, 전송 계층의 포트 번호이다. 인터넷에서 통신하기 위해서는 송신 호스트가 자신의 세 가지 주소뿐만 아니라,
수신 호스트의 세 가지 주소도 모두 알아야 함. 편지를 보내기 위해 자신의 집 주소와 수신자 집 주소를 모두 알아야 하는 것과 같은. 먼저, 포트 번호는 사용자 프로그램 환경에서 사용되므로, 번호 할당과
관리가 다른 계층 프로토콜의 동작에 크게 영향을 미치지 않음.
- IP 주소와 MAC 주소는 프로토콜의 동작 특성상 몇 가지 고려 사항이 있음. 예를 들어, 계층 2 프로토콜을 이용해 데이터를 전송하려면 수신 호스트의 MAC 주소가 필요함. 일반적으로 송신 호스트는
자신의 IP 주소와 MAC 주소를 쉽게 얻을 수 있음. 즉, 자신의 IP 주소는 호스트의 네트워크 설정 과정에서 하드디스크에 저장되며, MAC 주소는 LAN 카드 내에 기록되어 있음.
- 그렇지만 수신 호스트의 주소를 얻으려면 몇 단계의 처리 과정 필요. 먼저, 수신 호스트의 IP 주소는 응용 프로그램의 사용자로부터 입력된 호스트 이름을 IP 주소로 변환하여 얻을 수 있음. 하지만 수신
호스트의 MAC 주소는 어디에서도 얻을 수 없다. 따라서 사용자로부터 입력된 수신 호스트의 IP 주소를 이용해 MAC 주소를 구하는 기능이 필요한데, ARP 가 이 기능을 담당.
- 호스트의 IP 주소는 컴퓨터 설정 작업의 초기화 과정에서 특정 파일에 보관됨, 그러나 파일 시스템이 존재하지 않는 특수 목적의 시스템은 LAN 카드에 내장된 자신의 MAC 주소는 알지만, 자신의 IP
주소는 모르는 경우가 있음. 이 문제를 해결하기 위해 MAC 주소를 IP 주소로 변환하는 RARP가 필요함.

### ICMP (Internet Control Message Protocol)
- 데이터 전송 프로토콜인 IP가 동작하는 과정에서 전송 오류가 발생할 수 있음. 오류가 발생하면 반드시 송신자에게 회신해 복구 작업을 하게 해야 하는데 이 작업은 ICMP가 담당함.
- ICMP 프로토콜은 오류 메시지르 전송하기 위한 별도의 헤더 구조를 가지며, IP 패킷에 캡슐화 되어 전송되지만, IP와 같은 계층으로 취급됨.

#### ARP, RARP, ICMP 비교
| 프로토콜 | 특징                                                                                                                                                                         |
|------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ARP  | 인터넷에서 통신하려면 자신의 로컬 IP 주소와 MAC 주소, 수신 호스트의 IP 주소와 MAC 주소가 필요함. ARP는 수신 호스트의 주소 변환 기능을 제공하는데, 사용자가 입력한 원격 IP 주소를 이용해 원격 MAC 주소를 제공하는 프로토콜                                    |
| RARP | RARP는 로컬 호스트의 주소 변환 기능을 제공하는데, LAN 카드에 보관된 MAC 주소를 이용해 자신의 IP 주소를 얻어내는 프로토콜. 일반 컴퓨터 시스템은 로컬 호스트의 IP 주소가 파일 시스템에 보관되므로 RARP를 사용하지 않지만, 파일 시스템이 존재하는 시스템에서는 RARP를 반드시 사용해야 함 |
| ICMP | 사용자 데이터 전송 과정에서 오류가 발생하면 오류 메시지가 생성됨, ICMP는 이 오류 메시지를 송신 호스트에 전송하는 기능을 담당하는 프로토콜                                                                                           |
