# 30. 뷰 작성과 삭제
- 뷰는 테이블과 같은 부류의 데이터베이스 객체 중 하나.
- 뷰의 작성 및 삭제
```text
CREATE VIEW 뷰명 AS SELECT 명령
DROP VIEW 뷰명
```
- 서브쿼리는 FROM 구에서도 기술할 수 있었다. 여기서 FROM 구에 기술된 서브쿼리에 이름을 붙이고 데이터베이스 객체화해 쓰기 쉽게 한 것을 뷰라고 함.

## 1. 뷰
- 대이터베이스 객체란 테이블이나 인덱스 등 데이터베이스 안에 정의하는 모든 것. 뷰 역시 데이터베이스 객체 중 하나. 반면 SELECT 명령은 객체가 아님.
SELECT 명령에 이름을 지정할 수도 없고, 데이터베이스에 등록되지도 않기 때문.
- 이처럼 본래 데이터베이스 객체로 등록할 수 없는 SELECT 명령을, 객체로서 이름을 붙여 관리할 수 있도록 한 것이 뷰. SELECT 명령은 실행했을 때 테이블에
저장된 데이터를 결괏값으로 반환함. 따라서 뷰를 참조하면 그에 정의된 SELECT 명령의 실행결과를 테이블처럼 사용 가능.
> 뷰는 SELECT 명령을 기록하는 데이터베이스 객체다!
- FROM 구에는 서브쿼리를 사용할 수 있었다. 예를 들면 다음과 같은 SELECT 명령.
```sql
SELECT * FROM (SELECT * FROM sample54) sq;
```
- 위 서브쿼리 부분을 '뷰 객체'로 만들면 다음과 같은 SELECT 명령이 된다.
```sql
SELECT * FROM sample_view_67;
```
- sample_view_67은 뷰의 이름. 뷰를 정의할 때는 이름과 SELECT 명령을 지정함. 뷰를 만든 후에는 SELECT 명령에서 뷰의 이르을 지정하면 참조할 수 있음.
- 위 서브쿼리 부분이 단순한 SELECT 명령으로 되어 있지만, 실제 업무에서는 WHERE 구로 조건을 지정하거나 GROUP BY 구로 집계하는 등 좀 더 복잡한 명령으로
이루어지는 경우가 많다. 이런 경우 서브쿼리 부분을 뷰로 대체해 SELECT 명령을 간략하게 표현 가능. 또한 뷰를 사용함으로써 복잡한 SELECT 명령을
데이터베이스에 등록해 두었따가 나중에 간단히 실행할 수도 있다. 즉, 자주 사용하거나 복잡한 SELECT 명령을 뷰로 만들어 편리하게 사용할 수 있는 것.
> 뷰를 작성하는 것으로 복잡한 SELECT 명령을 간략하게 표현할 수 있다!

### 가상 테이블
- 뷰는 테이블처럼 취급할 수 있지만 '실체가 존재하지 않는다'는 의미로 '가상 테이블'이라 불리기도 함. SELECT 명령으로 이루어지는 뷰는 테이블처럼 데이터를
쓰거나 지울 수 있는 저장공간을 가지지 않는다. 이 때문에 테이블처럼 취급할 수 있다고는 해도 'SELECT 명령에서만 사용'하는 것을 권장.
- INSERT나 UPDATE, DELETE 명령에서도 조건이 맞으면 가능하지만 사용에 주의할 필요가 있다.

## 2. 뷰 작성과 삭제
- 뷰는 데이터베이스 객체이기 때문에 DDL로 작성하거나 삭제함. 작성할 때는 CREATE VIEW, 삭제할 때는 DROP VIEW를 사용.

### 뷰의 작성
- CREATE VIEW
```sql
CREATE VIEW 뷰명 AS SELECT 명령
```
- CREATE VIEW 다음에 뷰의 이름을 지정하고, AS 로 SELECT 명령을 지정함. CREATE VIEW의 AS 키워드는 별칭 AS 와 달리 생략 불가능함.
- 뷰 작성하기
```text
mysql> create view sample_view_67 as select * from sample54;
Query OK, 0 rows affected (0.14 sec)

mysql> select * from sample_view_67;
+------+------+
| no   | a    |
+------+------+
|    1 |  100 |
|    2 |   90 |
|    4 |   80 |
+------+------+
3 rows in set (0.00 sec)
```
- CREATE VIEW로 뷰를 작성한 뒤 SELECT 명령의 FROM 구에 지정해 사용 가능. 뷰는 필요에 따라 열을 지정할 수도 있는데, 이 경우에는 이름 뒤에 괄호로 
묶어 열을 나열함.
- CREATE  VIEW에서 열 지정하기
```text
CREATE VIEW 뷰명 (열명1, 열명2, ...) AS SELECT 명령
```
- 뷰의 열 지정을 생략한 경우에는 SELECT 명령의 SELECT 구에서 지정하는 열 정보가 수집되어 자동적으로 뷰의 열로 지정됨. 반대로 열을 지정한 경우에는 
SELECT 명령의 SELECT 구에 지정한 열보다 우선됨. 다만 SELECT 명령ㅇ의 SELECT 구와 같은 수의 열을 일일이 지정해야 하므로 SELECT 명령의 모든 열을
사용할 경우에는 지정하지 않는 편이 낫다. 또한 열 이외에는 정의할 수 없으며, 테이블의 열을 정의할 때처러 자료형이나 제약도 지정 불가.
- 열을 지정해 뷰 작성하기
```text
mysql> create view sample_view_672(n, v, v2) as select no, a, a * 2 from sample54;
Query OK, 0 rows affected (0.01 sec)

mysql> select * from sample_view_672;
+------+------+------+
| n    | v    | v2   |
+------+------+------+
|    1 |  100 |  200 |
|    2 |   90 |  180 |
|    4 |   80 |  160 |
+------+------+------+
3 rows in set (0.00 sec)
```

### 뷰 삭제
- 뷰를 삭제할 경우에는 DROP VIEW를 사용. 일단 뷰를 삭제하면 더 이상 뷰를 참조해 사용 불가.
- DROP VIEW
```sql
DROP VIEW 뷰명
```
```text
mysql> drop view sample_view_67;
Query OK, 0 rows affected (0.00 sec)
```

## 3. 뷰의 약점
- 뷰는 데이터베이스 객체로서 저장장치에 저장됨. 하지만 테이블과 달리 대량의 저장공간을 필요로 하지 않음. 데이터베이스에 저장되는 것은 SELECT 명령뿐이기 
때문. 다만 저장공간을 소비하지 않는 대신 CPU 자원을 사용.
- SELECT 명령은 데이터베이스의 테이블에서 행을 검색해 클라이언트로 반환하는 명령. 검색뿐 아니라 ORDER BY로 정령하거나 GROUP BY로 집계 가능. 이러한
처리는 계산능력을 필요로 하기 때문에 컴퓨터의 CPU를 사용.
- 뷰를 참조하면 뷰에 등록되어 있는 SELECT 명령이 실행됨. 실행 결과는 일시적으로 보존되며, 뷰를 참조할 때마다 SELECT 명령이 실행됨.

### 머티리얼라이즈드 뷰(Materialized View)
- 뷰에도 약점은 있다. 뷰의 근원이 되는 데이블에 보관하는 데이터양이 많은 경우 집계처리를 할 때도 뷰가 사용된다면 처리속도가 많이 떨어질 수 밖에 없다. 뷰를
중첩해서 사용하는 경우에도 처리 속도가 떨어지기 쉽다.
- 이 같은 상황을 회피하기 위해 사용할 수 있는 것이 머티리얼라이즈드 뷰. 일반적으로 뷰는 데이터를 일시적으로 저장했다가 쿼리가 실행 종료될 떄 함꼐 삭제됨.
그에 비해 머티리얼라이즈드 뷰는 데이터를 일시적으로 저장해 사용하는 것이 아니라 테이블처럼 저장장치에 저장해두고 사용함.
- 머티리얼라이즈드 뷰는 처믕 참조되었을 떄 데이터를 저장해둠. 이후 다시 참조할 때 이전에 저장해 두었던 데이터를 그대로 사용함. 일반적인 뷰처럼 매번 
SELECT 명령을 실행할 필요가 없다. 다만 뷰에 지정된 테이블의 데이터가 변경된 경우 SELECT 명령을 재실행해 데이터를 다시 저장함. 이처럼 변경 유무를 확인해
재실행하는 것은 RDBMS가 자동으로 실행함.
- 뷰에 지정된 테이블의 데이터가 자주 변경되지 않는 경우라면 머티리얼라이즈드 뷰를 사용해 뷰의 약점을 어느 정도 보완할 수 있다. 다만, 한 가지 아쉬운 점이
있다면 MySQL에서는 머티리얼라이즈드 뷰를 사용할 수 없다. 지금으로서는 Oracle과 DB2에서만 사용할 수 있는 데이터베이스 객체.

### 함수 테이블
- 뷰는 또 하나의 약점을 가짐. 뷰를 구성하는 SELECT 명령은 단독으로도 실행할 수 있어야 함. 상관 서브쿼리에서처럼, 부모 쿼리와 어떤식으로든 연관된
서브쿼리의 경우에는 뷰의 SELECT 명령으로 사용 불가. 대신 이 같은 뷰의 약점을 함수 테이블을 사용해 회피할 수 있다. 함수 테이블은 테이블을 결괏값으로
반환해주는 사용자정의 함수. 함수에는 인수를 지정할 수 있기 때문에 인수의 값에 따라 WHERE 조건을 붙여 결괏값을 바꿀 수 있다. 그에 따라 상관 서브쿼리처럼
동작할 수 있다.

